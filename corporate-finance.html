<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corporate Finance - AccountingQuest</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        :root {
            --bg-primary: #0f1419;
            --bg-secondary: #1a1f2e;
            --bg-card: #1e2538;
            --text-primary: #e7e9ea;
            --text-secondary: #8b98a5;
            --accent-green: #4ade80;
            --accent-blue: #3b82f6;
            --accent-red: #ef4444;
            --accent-orange: #f97316;
            --border-color: #2f3b52;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .back-btn {
            background: var(--border-color);
            color: var(--text-primary);
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .back-btn:hover {
            background: var(--accent-green);
            color: #000;
        }

        .header h1 {
            font-size: 1.3em;
            color: var(--accent-green);
        }

        .stats {
            display: flex;
            gap: 20px;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 1.4em;
            font-weight: 700;
            color: var(--accent-green);
        }

        .stat-label {
            font-size: 0.75em;
            color: var(--text-secondary);
        }

        /* Main Layout */
        .main-container {
            display: flex;
            min-height: calc(100vh - 70px);
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            padding: 20px;
            overflow-y: auto;
        }

        .sidebar h3 {
            color: var(--accent-green);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .topic-btn {
            width: 100%;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 12px 15px;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 10px;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.2s;
        }

        .topic-btn:hover {
            border-color: var(--accent-green);
            background: var(--bg-secondary);
        }

        .topic-btn.active {
            border-color: var(--accent-green);
            background: rgba(74, 222, 128, 0.1);
        }

        .topic-icon {
            font-size: 1.2em;
        }

        .topic-info {
            flex: 1;
        }

        .topic-name {
            font-weight: 600;
            font-size: 0.95em;
        }

        .topic-count {
            font-size: 0.75em;
            color: var(--text-secondary);
        }

        /* Content Area */
        .content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        /* Mode Selector */
        .mode-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
        }

        .mode-btn {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .mode-btn:hover {
            border-color: var(--accent-blue);
        }

        .mode-btn.active {
            background: var(--accent-blue);
            border-color: var(--accent-blue);
            color: #fff;
        }

        /* Question Card */
        .question-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .question-number {
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        .difficulty-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75em;
            font-weight: 700;
        }

        .difficulty-easy {
            background: rgba(74, 222, 128, 0.2);
            color: var(--accent-green);
        }

        .difficulty-medium {
            background: rgba(249, 115, 22, 0.2);
            color: var(--accent-orange);
        }

        .difficulty-hard {
            background: rgba(239, 68, 68, 0.2);
            color: var(--accent-red);
        }

        .question-text {
            font-size: 1.15em;
            line-height: 1.6;
            margin-bottom: 25px;
        }

        /* Options */
        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 10px;
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .option:hover {
            border-color: var(--accent-blue);
            background: var(--bg-card);
        }

        .option.selected {
            border-color: var(--accent-blue);
            background: rgba(59, 130, 246, 0.1);
        }

        .option.correct {
            border-color: var(--accent-green);
            background: rgba(74, 222, 128, 0.1);
        }

        .option.incorrect {
            border-color: var(--accent-red);
            background: rgba(239, 68, 68, 0.1);
        }

        .option-letter {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--border-color);
            border-radius: 8px;
            font-weight: 700;
            font-size: 0.9em;
        }

        .option.correct .option-letter {
            background: var(--accent-green);
            color: #000;
        }

        .option.incorrect .option-letter {
            background: var(--accent-red);
            color: #fff;
        }

        /* Explanation */
        .explanation {
            margin-top: 20px;
            padding: 20px;
            background: var(--bg-secondary);
            border-radius: 10px;
            border-left: 4px solid var(--accent-green);
        }

        .explanation h4 {
            color: var(--accent-green);
            margin-bottom: 10px;
        }

        .explanation p {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Calculator Section */
        .calculator-section {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            margin-top: 20px;
        }

        .calculator-section h3 {
            color: var(--accent-blue);
            margin-bottom: 20px;
        }

        .calc-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .calc-input {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .calc-input label {
            font-size: 0.85em;
            color: var(--text-secondary);
        }

        .calc-input input {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 12px;
            border-radius: 8px;
            font-size: 1em;
        }

        .calc-input input:focus {
            outline: none;
            border-color: var(--accent-blue);
        }

        .calc-result {
            background: var(--bg-secondary);
            border: 2px solid var(--accent-green);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin-top: 20px;
        }

        .calc-result-label {
            color: var(--text-secondary);
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .calc-result-value {
            font-size: 2em;
            font-weight: 700;
            color: var(--accent-green);
        }

        .calc-btn {
            background: var(--accent-blue);
            color: #fff;
            border: none;
            padding: 14px 28px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1em;
            margin-top: 15px;
            width: 100%;
        }

        .calc-btn:hover {
            opacity: 0.9;
        }

        /* Navigation Buttons */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 25px;
        }

        .nav-btn {
            background: var(--border-color);
            color: var(--text-primary);
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-btn:hover {
            background: var(--accent-green);
            color: #000;
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .nav-btn.primary {
            background: var(--accent-green);
            color: #000;
        }

        /* Results */
        .results-card {
            background: var(--bg-card);
            border: 2px solid var(--accent-green);
            border-radius: 12px;
            padding: 40px;
            text-align: center;
        }

        .results-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .results-score {
            font-size: 3em;
            font-weight: 700;
            color: var(--accent-green);
            margin-bottom: 10px;
        }

        .results-text {
            color: var(--text-secondary);
            margin-bottom: 30px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid var(--border-color);
                display: flex;
                overflow-x: auto;
                gap: 10px;
                padding: 15px;
            }

            .sidebar h3 {
                display: none;
            }

            .topic-btn {
                flex-shrink: 0;
                width: auto;
            }

            .content {
                padding: 20px;
            }

            .mode-selector {
                flex-wrap: wrap;
            }

            .calc-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-left">
            <button class="back-btn" onclick="location.href='index.html'">‚Üê Tilbake</button>
            <h1>üí∞ Corporate Finance</h1>
        </div>
        <div class="stats">
            <div class="stat">
                <div class="stat-value" id="score">0</div>
                <div class="stat-label">Poeng</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="streak">0</div>
                <div class="stat-label">Streak</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="correct-count">0/0</div>
                <div class="stat-label">Riktige</div>
            </div>
        </div>
    </header>

    <div class="main-container">
        <aside class="sidebar">
            <h3>üìö Temaer</h3>
            <button class="topic-btn active" data-topic="npv" onclick="selectTopic('npv')">
                <span class="topic-icon">üíµ</span>
                <div class="topic-info">
                    <div class="topic-name">NPV & IRR</div>
                    <div class="topic-count">15 sp√∏rsm√•l</div>
                </div>
            </button>
            <button class="topic-btn" data-topic="wacc" onclick="selectTopic('wacc')">
                <span class="topic-icon">‚öñÔ∏è</span>
                <div class="topic-info">
                    <div class="topic-name">WACC & CAPM</div>
                    <div class="topic-count">12 sp√∏rsm√•l</div>
                </div>
            </button>
            <button class="topic-btn" data-topic="bonds" onclick="selectTopic('bonds')">
                <span class="topic-icon">üìú</span>
                <div class="topic-info">
                    <div class="topic-name">Obligasjoner</div>
                    <div class="topic-count">10 sp√∏rsm√•l</div>
                </div>
            </button>
            <button class="topic-btn" data-topic="portfolio" onclick="selectTopic('portfolio')">
                <span class="topic-icon">üìà</span>
                <div class="topic-info">
                    <div class="topic-name">Portef√∏lje</div>
                    <div class="topic-count">12 sp√∏rsm√•l</div>
                </div>
            </button>
            <button class="topic-btn" data-topic="dividends" onclick="selectTopic('dividends')">
                <span class="topic-icon">üí∞</span>
                <div class="topic-info">
                    <div class="topic-name">Dividender</div>
                    <div class="topic-count">8 sp√∏rsm√•l</div>
                </div>
            </button>
            <button class="topic-btn" data-topic="options" onclick="selectTopic('options')">
                <span class="topic-icon">üìä</span>
                <div class="topic-info">
                    <div class="topic-name">Opsjoner & Hedging</div>
                    <div class="topic-count">8 sp√∏rsm√•l</div>
                </div>
            </button>
        </aside>

        <main class="content" id="content">
            <!-- Mode Selector -->
            <div class="mode-selector">
                <button class="mode-btn active" data-mode="quiz" onclick="setMode('quiz')">‚ùì Quiz</button>
                <button class="mode-btn" data-mode="calc" onclick="setMode('calc')">üßÆ Kalkulator</button>
                <button class="mode-btn" data-mode="theory" onclick="setMode('theory')">üìñ Teori</button>
            </div>

            <!-- Quiz Mode -->
            <div id="quiz-mode">
                <div class="question-card" id="question-card">
                    <div class="question-header">
                        <span class="question-number">Sp√∏rsm√•l <span id="q-num">1</span> av <span id="q-total">10</span></span>
                        <span class="difficulty-badge difficulty-medium" id="q-difficulty">Middels</span>
                    </div>
                    <p class="question-text" id="q-text">Laster sp√∏rsm√•l...</p>
                    <div class="options" id="options">
                        <!-- Options will be inserted here -->
                    </div>
                    <div class="explanation hidden" id="explanation">
                        <h4>üí° Forklaring</h4>
                        <p id="explanation-text"></p>
                    </div>
                </div>

                <div class="nav-buttons">
                    <button class="nav-btn" id="prev-btn" onclick="prevQuestion()" disabled>‚Üê Forrige</button>
                    <button class="nav-btn primary" id="next-btn" onclick="nextQuestion()">Neste ‚Üí</button>
                </div>
            </div>

            <!-- Calculator Mode -->
            <div id="calc-mode" class="hidden">
                <div class="calculator-section">
                    <h3>üíµ NPV Kalkulator</h3>
                    <div class="calc-grid">
                        <div class="calc-input">
                            <label>Initial investering (C‚ÇÄ)</label>
                            <input type="number" id="npv-c0" placeholder="f.eks. 100000">
                        </div>
                        <div class="calc-input">
                            <label>Diskonteringsrente (%)</label>
                            <input type="number" id="npv-rate" placeholder="f.eks. 10">
                        </div>
                        <div class="calc-input">
                            <label>Kontantstr√∏m √Ör 1</label>
                            <input type="number" id="npv-cf1" placeholder="f.eks. 30000">
                        </div>
                        <div class="calc-input">
                            <label>Kontantstr√∏m √Ör 2</label>
                            <input type="number" id="npv-cf2" placeholder="f.eks. 40000">
                        </div>
                        <div class="calc-input">
                            <label>Kontantstr√∏m √Ör 3</label>
                            <input type="number" id="npv-cf3" placeholder="f.eks. 50000">
                        </div>
                        <div class="calc-input">
                            <label>Kontantstr√∏m √Ör 4</label>
                            <input type="number" id="npv-cf4" placeholder="f.eks. 60000">
                        </div>
                    </div>
                    <button class="calc-btn" onclick="calculateNPV()">Beregn NPV</button>
                    <div class="calc-result hidden" id="npv-result">
                        <div class="calc-result-label">Netto N√•verdi (NPV)</div>
                        <div class="calc-result-value" id="npv-value">0</div>
                    </div>
                </div>

                <div class="calculator-section" style="margin-top: 20px;">
                    <h3>‚öñÔ∏è WACC Kalkulator</h3>
                    <div class="calc-grid">
                        <div class="calc-input">
                            <label>Markedsverdi Egenkapital</label>
                            <input type="number" id="wacc-e" placeholder="f.eks. 400000">
                        </div>
                        <div class="calc-input">
                            <label>Markedsverdi Gjeld</label>
                            <input type="number" id="wacc-d" placeholder="f.eks. 600000">
                        </div>
                        <div class="calc-input">
                            <label>Avkastningskrav EK (%)</label>
                            <input type="number" id="wacc-re" placeholder="f.eks. 15">
                        </div>
                        <div class="calc-input">
                            <label>Gjeldsrente (%)</label>
                            <input type="number" id="wacc-rd" placeholder="f.eks. 7">
                        </div>
                        <div class="calc-input">
                            <label>Skattesats (%)</label>
                            <input type="number" id="wacc-tax" placeholder="f.eks. 22">
                        </div>
                    </div>
                    <button class="calc-btn" onclick="calculateWACC()">Beregn WACC</button>
                    <div class="calc-result hidden" id="wacc-result">
                        <div class="calc-result-label">Vektet Gjennomsnittlig Kapitalkostnad (WACC)</div>
                        <div class="calc-result-value" id="wacc-value">0%</div>
                    </div>
                </div>
            </div>

            <!-- Theory Mode -->
            <div id="theory-mode" class="hidden">
                <div class="question-card">
                    <h3 style="color: var(--accent-green); margin-bottom: 20px;">üìñ Teori: NPV & IRR</h3>
                    
                    <h4 style="margin-top: 20px; margin-bottom: 10px;">Netto N√•verdi (NPV)</h4>
                    <p style="color: var(--text-secondary); line-height: 1.8;">
                        NPV er differansen mellom n√•verdien av fremtidige kontantstr√∏mmer og den initielle investeringen.
                        <br><br>
                        <strong style="color: var(--text-primary);">Formel:</strong> NPV = -C‚ÇÄ + CF‚ÇÅ/(1+r) + CF‚ÇÇ/(1+r)¬≤ + ... + CF‚Çô/(1+r)‚Åø
                        <br><br>
                        <strong style="color: var(--text-primary);">Beslutningsregel:</strong>
                        <br>‚Ä¢ NPV > 0: Godta prosjektet
                        <br>‚Ä¢ NPV < 0: Avvis prosjektet
                        <br>‚Ä¢ NPV = 0: Indifferent
                    </p>

                    <h4 style="margin-top: 30px; margin-bottom: 10px;">Internrente (IRR)</h4>
                    <p style="color: var(--text-secondary); line-height: 1.8;">
                        IRR er diskonteringsrenten som gir NPV = 0. Det er prosjektets implisitte avkastning.
                        <br><br>
                        <strong style="color: var(--text-primary);">Beslutningsregel:</strong>
                        <br>‚Ä¢ IRR > avkastningskrav: Godta prosjektet
                        <br>‚Ä¢ IRR < avkastningskrav: Avvis prosjektet
                    </p>

                    <h4 style="margin-top: 30px; margin-bottom: 10px;">Viktige poeng</h4>
                    <ul style="color: var(--text-secondary); line-height: 2; margin-left: 20px;">
                        <li>NPV er alltid foretrukket over IRR ved gjensidig utelukkende prosjekter</li>
                        <li>IRR kan gi flere l√∏sninger ved ikke-konvensjonelle kontantstr√∏mmer</li>
                        <li>Annuiteter og perpetuiteter har forenklede formler</li>
                        <li>Annuitet due: Multipliser vanlig annuitet med (1+r)</li>
                    </ul>
                </div>
            </div>

            <!-- Results -->
            <div id="results-mode" class="hidden">
                <div class="results-card">
                    <div class="results-icon">üéâ</div>
                    <div class="results-score" id="final-score">8/10</div>
                    <p class="results-text">Godt jobbet! Du har fullf√∏rt dette temaet.</p>
                    <button class="nav-btn primary" onclick="restartQuiz()">Pr√∏v igjen</button>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyAPuacYOSf4Hv-h36yA5Hav67SlpIFMIIQ",
            authDomain: "accountingquest-multiplayer.firebaseapp.com",
            databaseURL: "https://accountingquest-multiplayer-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "accountingquest-multiplayer"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }

        // Corporate Finance Questions
        const questions = {
            npv: [
                {
                    q: "Et firma vurderer to prosjekter med f√∏lgende kontantstr√∏mmer:\nProsjekt A: -75, 5, 30, 50\nProsjekt B: -60, 50, 28, 0\nHvis avkastningskravet er 10%, hvilke(t) prosjekt(er) b√∏r velges hvis du har begrenset kapital?",
                    options: ["A", "B", "Ingen", "Begge"],
                    correct: 1,
                    explanation: "NPV for A = -8.10, NPV for B = 8.60. B har positiv NPV og er h√∏yest, s√• velg B.",
                    difficulty: "medium"
                },
                {
                    q: "Du tilbys en 10-√•rs annuitet som betaler $1000 per √•r, med f√∏rste betaling umiddelbart. Hva er maksimum du b√∏r betale hvis renten er 5%?",
                    options: ["$7,354.03", "$7,721.73", "$8,107.82", "$8,500.00"],
                    correct: 2,
                    explanation: "Dette er en annuitet due. Beregn vanlig annuitet og multipliser med (1+r): 1000*((1/0.05)-(1/(0.05*(1.05^10))))*1.05 = 8,107.82",
                    difficulty: "medium"
                },
                {
                    q: "Din far tilbyr √• betale deg $100 per √•r i tre √•r, startende 2 √•r fra i dag. Hvis diskonteringsrenten er 9%, hva er n√•verdien?",
                    options: ["$200.00", "$213.05", "$232.23", "$253.13"],
                    correct: 1,
                    explanation: "Dette er en forsinket annuitet. Beregn som vanlig annuitet, men diskontert med 1 √•r: 100*((1/.09)-(1/(0.09*(1.09^3))))*(1/(1.09)) = 213.05",
                    difficulty: "hard"
                },
                {
                    q: "Vurder f√∏lgende alternativer:\ni. $100 mottatt om 1 √•r\nii. $200 mottatt om 5 √•r\niii. $300 mottatt om 10 √•r\nHvilket er best ved 10% rente vs 5% rente?",
                    options: ["i og ii, henholdsvis", "ii og i, henholdsvis", "ii og iii, henholdsvis", "Ingen av de ovenfor"],
                    correct: 2,
                    explanation: "Ved 10%: PV(i)=90.91, PV(ii)=124.18, PV(iii)=115.66 ‚Üí ii er best. Ved 5%: PV(i)=95.24, PV(ii)=156.71, PV(iii)=184.17 ‚Üí iii er best.",
                    difficulty: "hard"
                },
                {
                    q: "Ved hvilken rente er du indifferent mellom:\nProsjekt A: -20, 35\nProsjekt B: -30, 50",
                    options: ["15%", "25%", "35%", "50%"],
                    correct: 3,
                    explanation: "Sett NPV lik for begge: -20+35/(1+r) = -30+50/(1+r). L√∏s for r: 10 = 15/(1+r), r = 50%",
                    difficulty: "medium"
                }
            ],
            wacc: [
                {
                    q: "Aksjer i Firma X selges for $20, siste dividende var $2.00, vekst er 5% √•rlig. Gjeldsrente er 7%, skattesats 30%. Kapitalstruktur: EK $200,000, Gjeld $50,000. Hva er WACC?",
                    options: ["9.4%", "12.85%", "13.38%", "13.8%"],
                    correct: 2,
                    explanation: "Re = (2*1.05/20) + 0.05 = 15.5%. Vekt gjeld = 20%, vekt EK = 80%. WACC = (0.7*0.07*0.2) + (0.155*0.8) = 13.38%",
                    difficulty: "hard"
                },
                {
                    q: "Hva skjer med avkastning til egenkapital og WACC hvis firmaet √∏ker gjelden?",
                    options: ["√òker; WACC √∏ker", "Ingen endring; WACC √∏ker", "Reduseres; WACC reduseres", "Ingen endring; WACC reduseres"],
                    correct: 3,
                    explanation: "Med mer gjeld (som har lavere kostnad etter skatt), g√•r WACC ned. Avkastning p√• EK forblir uendret hvis alt annet er konstant.",
                    difficulty: "medium"
                },
                {
                    q: "Estimert beta for Firma X er 0.7. Risikofri rente er 3%, markedsavkastning er 8%. Firmaet har gjeld til 2% premium over risikofri. Skattesats er 30%. Hva er etter-skatt kostnad for gjeld?",
                    options: ["3.5%", "4.0%", "4.2%", "5.0%"],
                    correct: 0,
                    explanation: "Gjeldsrente = 3% + 2% = 5%. Etter-skatt kostnad = 5% * (1 - 0.30) = 3.5%",
                    difficulty: "easy"
                },
                {
                    q: "En portef√∏lje inneholder 4 aktiva. Beta-verdier: 0.5 (30%), 1.5 (30%), 1.8 (20%), 0.7 (20%). Risikofri rente 2%, markedspremie 6%. 70% i risikabel portef√∏lje, 30% risikofri. Hva er total portef√∏lje-beta?",
                    options: ["0.57", "0.77", "0.83", "1.1"],
                    correct: 1,
                    explanation: "Risikabel portef√∏lje beta = 0.5*0.3 + 1.5*0.3 + 1.8*0.2 + 0.7*0.2 = 1.1. Total beta = 0.7*1.1 + 0.3*0 = 0.77",
                    difficulty: "hard"
                },
                {
                    q: "WACC for et firma er 10%, gjeld-til-egenkapital ratio er 0. Hva er avkastningen til aksjon√¶rene?",
                    options: ["0%", "5%", "10%", "15%"],
                    correct: 2,
                    explanation: "Ingen gjeld betyr at WACC = kostnad for egenkapital = 10%",
                    difficulty: "easy"
                }
            ],
            bonds: [
                {
                    q: "En obligasjon har halv√•rlige kuponger p√• 10% p.a., 2 √•r til forfall, avkastningskrav 5% p.a., p√•lydende 1000. Hva er n√•verdien?",
                    options: ["$1,092.97", "$1,094.05", "$154.18", "$76.54"],
                    correct: 1,
                    explanation: "4 kuponger √° $50 (5% halv√•rlig), diskontert med 2.5% per periode. PV = 50/1.025 + 50/1.025¬≤ + 50/1.025¬≥ + 50/1.025‚Å¥ + 1000/1.025‚Å¥ = 1094.05",
                    difficulty: "medium"
                },
                {
                    q: "En obligasjon med pris under p√•lydende er:",
                    options: ["Premieobligasjon; avkastning > kupongrente", "Diskonteringsobligasjon; avkastning > kupongrente", "Premieobligasjon; avkastning < kupongrente", "Diskonteringsobligasjon; avkastning < kupongrente"],
                    correct: 1,
                    explanation: "Pris under p√•lydende = diskonteringsobligasjon. Investorer f√•r kapitalgevinst, s√• total avkastning > kupongrente.",
                    difficulty: "easy"
                },
                {
                    q: "Tre nullkupongobligasjoner (alle med p√•lydende 1000) har √•rlig YTM p√• R) 5%, X) 10%, Z) 12%, og 3 √•r til forfall. Hvilken har h√∏yest pris?",
                    options: ["R", "X", "Z"],
                    correct: 0,
                    explanation: "Nullkupong = ingen kuponger. Lavest YTM gir h√∏yest pris fordi PV = FV/(1+r)‚Åø. R har lavest YTM = h√∏yest pris.",
                    difficulty: "easy"
                },
                {
                    q: "Firma A har restrukturert obligasjonene sine. 10 √•r til forfall, 10% kupong √•rlig. Ingen kuponger de f√∏rste 5 √•rene, deretter normale kuponger + utsatte kuponger ved forfall. Avkastningskrav 15%. Hva er prisen?",
                    options: ["Ca. $500", "Ca. $650", "Ca. $800", "Krever mer beregning"],
                    correct: 3,
                    explanation: "Kompleks beregning som krever √• diskontere utsatte kuponger og p√•lydende. Svaret krever detaljert utregning.",
                    difficulty: "hard"
                }
            ],
            portfolio: [
                {
                    q: "Aksje A har forventet avkastning:\nResesjon (25%): -7%\nNormal (40%): 5%\nEkspansjon (35%): 6%\nHva er forventet avkastning?",
                    options: ["1.33%", "2.00%", "2.35%", "3.00%"],
                    correct: 2,
                    explanation: "E(R) = 0.25*(-0.07) + 0.40*(0.05) + 0.35*(0.06) = -0.0175 + 0.02 + 0.021 = 0.0235 = 2.35%",
                    difficulty: "easy"
                },
                {
                    q: "En portef√∏lje inneholder 5 aktiva. Hvilken aksje er mest aggressiv?\nA: Beta 0.4 (20%), B: Beta 1.6 (10%), C: Beta 2.0 (30%), D: Beta 1.0 (20%), E: Beta 0.75 (20%)",
                    options: ["A", "B", "C", "D", "E"],
                    correct: 2,
                    explanation: "Aksje C har h√∏yest beta (2.0), som betyr h√∏yest systematisk risiko = mest aggressiv.",
                    difficulty: "easy"
                },
                {
                    q: "Hva er beta til portef√∏ljen i forrige sp√∏rsm√•l?",
                    options: ["1.12", "1.19", "1.22", "1.42"],
                    correct: 1,
                    explanation: "Portef√∏lje beta = 0.4*0.2 + 1.6*0.1 + 2*0.3 + 1*0.2 + 0.75*0.2 = 0.08 + 0.16 + 0.6 + 0.2 + 0.15 = 1.19",
                    difficulty: "medium"
                },
                {
                    q: "Du har $100 √• investere. Risikofri rente er 5%, risikabel avkastning er 13%. Portef√∏lje A er 50/50, portef√∏lje B investerer $150 i risikofri. Forventet avkastning for hver?",
                    options: ["9% for A, 15% for B", "9% for A, 17% for B", "9% for A, 1% for B", "9% for A, -13% for B"],
                    correct: 2,
                    explanation: "A: 0.5*0.05 + 0.5*0.13 = 9%. B: vekter er 1.5 risikofri og -0.5 risikabel. 1.5*0.05 + (-0.5)*0.13 = 0.075 - 0.065 = 1%",
                    difficulty: "medium"
                },
                {
                    q: "Hvis en investor som holder 3 aksjer vil legge til √©n til, hvilken b√∏r hun velge?",
                    options: ["En aksje fra samme selskap", "En aksje fra samme bransje", "En aksje fra en annen bransje fordi diversifisering √∏ker", "En aksje fra en annen bransje fordi diversifisering reduseres"],
                    correct: 2,
                    explanation: "For √• maksimere diversifisering, velg en aksje fra en annen bransje. Dette reduserer korrelasjon og dermed portef√∏ljerisiko.",
                    difficulty: "easy"
                }
            ],
            dividends: [
                {
                    q: "Et firma betaler n√• $2 i dividende, forventet vekst 10% i 3 √•r, deretter 5% for alltid. Investorers avkastningskrav er 7%. Hva er aksjekursen?",
                    options: ["$100.42", "$108.42", "$114.42", "$120.42"],
                    correct: 3,
                    explanation: "PV av dividender √•r 1-3 + PV av terminalpris i √•r 3. Div4 = 2*1.1¬≥*1.05. P3 = Div4/(0.07-0.05). Diskont√©r alt tilbake. = 120.42",
                    difficulty: "hard"
                },
                {
                    q: "Et firma betalte akkurat $10 i dividende. Vekst 7% i 2 √•r, deretter 3% for alltid. Avkastningskrav 5%. Hva er aksjekursen?",
                    options: ["$483.51", "$555.38", "$576.15", "$875.63"],
                    correct: 1,
                    explanation: "Div1=10.7, Div2=11.449, Div3=11.79. P2=Div3/(r-g)=11.79/(0.05-0.03)=589.6. PV=10.7/1.05+11.449/1.05¬≤+589.6/1.05¬≤=555.38",
                    difficulty: "hard"
                },
                {
                    q: "Den voksende perpetuitetsmodellen antar at g<r. Er dette realistisk?",
                    options: ["Sant", "Usant"],
                    correct: 1,
                    explanation: "P√•standen sier at antakelsen er urealistisk. Det er usant - antakelsen ER realistisk fordi ingen vekstrate kan overstige avkastningskravet i det uendelige.",
                    difficulty: "easy"
                }
            ],
            options: [
                {
                    q: "En protective put:",
                    options: ["Setter en nedre grense p√• portef√∏ljeverdi lik ut√∏velsesprisen", "Lar deg holde b√•de put og call samtidig", "Gir deg opsjon til √• kj√∏pe ved prisfall", "Inkluderer salg av call og kj√∏p av put"],
                    correct: 0,
                    explanation: "En protective put begrenser nedside ved √• garantere at du kan selge til ut√∏velsesprisen, som setter en gulv p√• portef√∏ljeverdien.",
                    difficulty: "easy"
                },
                {
                    q: "Ditt firma har 100,000 AUD fordring om 3 m√•neder. Spotkurs er 10 NOK/AUD. Call-opsjon med premium 0.5, strike 11 NOK/AUD. Forventet kurs: 7 NOK (40%) eller 13 NOK (60%). B√∏r du hedge?",
                    options: ["Ja", "Nei", "Kan ikke avgj√∏res"],
                    correct: 0,
                    explanation: "Med hedge: 7.5*100000*0.4 + 11.5*100000*0.6 = 990,000 NOK. Uten hedge: 7*100000*0.4 + 13*100000*0.6 = 1,060,000 NOK. Hedge er billigere.",
                    difficulty: "hard"
                },
                {
                    q: "Hvis F(NOK/AUD) > S(NOK/AUD), betyr dette at:",
                    options: ["EUR selger til premie", "NOK selger til rabatt", "AUD selger til rabatt", "Ingen av de ovenfor"],
                    correct: 1,
                    explanation: "H√∏yere forward enn spot betyr at NOK vil v√¶re billigere i fremtiden (selger til rabatt), mens AUD selger til premie.",
                    difficulty: "medium"
                },
                {
                    q: "Et norsk firma har kundefordringer i USD. For √• hedge b√∏r de:",
                    options: ["Kj√∏pe put-opsjon p√• USD fordi de tror USD vil falle", "Kj√∏pe call-opsjon p√• USD fordi de tror USD vil stige", "Ikke gj√∏re noe siden de er norske"],
                    correct: 0,
                    explanation: "Med fordringer i USD vil de motta USD. En put lar dem selge USD til fast pris hvis USD faller, beskytter mot valutarisiko.",
                    difficulty: "medium"
                }
            ]
        };

        // State
        let currentTopic = 'npv';
        let currentMode = 'quiz';
        let currentQuestionIndex = 0;
        let score = 0;
        let streak = 0;
        let correctCount = 0;
        let answered = false;

        // Initialize
        function init() {
            const urlParams = new URLSearchParams(window.location.search);
            const topic = urlParams.get('topic');
            if (topic && questions[topic]) {
                selectTopic(topic);
            } else {
                loadQuestion();
            }
        }

        // Select topic
        function selectTopic(topic) {
            currentTopic = topic;
            currentQuestionIndex = 0;
            score = 0;
            streak = 0;
            correctCount = 0;
            answered = false;
            
            document.querySelectorAll('.topic-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.topic === topic);
            });
            
            loadQuestion();
            updateStats();
        }

        // Set mode
        function setMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.mode === mode);
            });
            
            document.getElementById('quiz-mode').classList.toggle('hidden', mode !== 'quiz');
            document.getElementById('calc-mode').classList.toggle('hidden', mode !== 'calc');
            document.getElementById('theory-mode').classList.toggle('hidden', mode !== 'theory');
            document.getElementById('results-mode').classList.add('hidden');
        }

        // Load question
        function loadQuestion() {
            const topicQuestions = questions[currentTopic];
            if (!topicQuestions || currentQuestionIndex >= topicQuestions.length) {
                showResults();
                return;
            }
            
            const q = topicQuestions[currentQuestionIndex];
            document.getElementById('q-num').textContent = currentQuestionIndex + 1;
            document.getElementById('q-total').textContent = topicQuestions.length;
            document.getElementById('q-text').textContent = q.q;
            
            const diffBadge = document.getElementById('q-difficulty');
            diffBadge.textContent = q.difficulty === 'easy' ? 'Lett' : q.difficulty === 'medium' ? 'Middels' : 'Vanskelig';
            diffBadge.className = `difficulty-badge difficulty-${q.difficulty}`;
            
            const optionsDiv = document.getElementById('options');
            optionsDiv.innerHTML = '';
            
            q.options.forEach((opt, i) => {
                const optEl = document.createElement('div');
                optEl.className = 'option';
                optEl.innerHTML = `
                    <span class="option-letter">${String.fromCharCode(65 + i)}</span>
                    <span>${opt}</span>
                `;
                optEl.onclick = () => selectOption(i);
                optionsDiv.appendChild(optEl);
            });
            
            document.getElementById('explanation').classList.add('hidden');
            answered = false;
            
            document.getElementById('prev-btn').disabled = currentQuestionIndex === 0;
            document.getElementById('next-btn').textContent = currentQuestionIndex === topicQuestions.length - 1 ? 'Fullf√∏r' : 'Neste ‚Üí';
        }

        // Select option
        function selectOption(index) {
            if (answered) return;
            answered = true;
            
            const q = questions[currentTopic][currentQuestionIndex];
            const options = document.querySelectorAll('.option');
            
            options.forEach((opt, i) => {
                opt.classList.remove('selected');
                if (i === q.correct) {
                    opt.classList.add('correct');
                } else if (i === index && i !== q.correct) {
                    opt.classList.add('incorrect');
                }
            });
            
            if (index === q.correct) {
                correctCount++;
                streak++;
                score += 10 + (streak * 2);
            } else {
                streak = 0;
            }
            
            document.getElementById('explanation-text').textContent = q.explanation;
            document.getElementById('explanation').classList.remove('hidden');
            
            updateStats();
        }

        // Navigation
        function nextQuestion() {
            if (!answered) return;
            currentQuestionIndex++;
            loadQuestion();
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
            }
        }

        // Show results
        function showResults() {
            document.getElementById('quiz-mode').classList.add('hidden');
            document.getElementById('results-mode').classList.remove('hidden');
            
            const total = questions[currentTopic].length;
            document.getElementById('final-score').textContent = `${correctCount}/${total}`;
            
            // Save progress
            localStorage.setItem('cf_progress', Math.round((correctCount / total) * 100));
        }

        function restartQuiz() {
            currentQuestionIndex = 0;
            correctCount = 0;
            streak = 0;
            score = 0;
            answered = false;
            
            document.getElementById('results-mode').classList.add('hidden');
            document.getElementById('quiz-mode').classList.remove('hidden');
            
            loadQuestion();
            updateStats();
        }

        // Update stats
        function updateStats() {
            document.getElementById('score').textContent = score;
            document.getElementById('streak').textContent = streak;
            document.getElementById('correct-count').textContent = `${correctCount}/${questions[currentTopic].length}`;
        }

        // Calculators
        function calculateNPV() {
            const c0 = parseFloat(document.getElementById('npv-c0').value) || 0;
            const rate = (parseFloat(document.getElementById('npv-rate').value) || 0) / 100;
            const cf1 = parseFloat(document.getElementById('npv-cf1').value) || 0;
            const cf2 = parseFloat(document.getElementById('npv-cf2').value) || 0;
            const cf3 = parseFloat(document.getElementById('npv-cf3').value) || 0;
            const cf4 = parseFloat(document.getElementById('npv-cf4').value) || 0;
            
            const npv = -c0 + cf1/(1+rate) + cf2/Math.pow(1+rate,2) + cf3/Math.pow(1+rate,3) + cf4/Math.pow(1+rate,4);
            
            document.getElementById('npv-result').classList.remove('hidden');
            document.getElementById('npv-value').textContent = npv.toFixed(2);
            document.getElementById('npv-value').style.color = npv >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';
        }

        function calculateWACC() {
            const e = parseFloat(document.getElementById('wacc-e').value) || 0;
            const d = parseFloat(document.getElementById('wacc-d').value) || 0;
            const re = (parseFloat(document.getElementById('wacc-re').value) || 0) / 100;
            const rd = (parseFloat(document.getElementById('wacc-rd').value) || 0) / 100;
            const tax = (parseFloat(document.getElementById('wacc-tax').value) || 0) / 100;
            
            const v = e + d;
            const wacc = (e/v)*re + (d/v)*rd*(1-tax);
            
            document.getElementById('wacc-result').classList.remove('hidden');
            document.getElementById('wacc-value').textContent = (wacc * 100).toFixed(2) + '%';
        }

        // Init
        init();
    </script>
</body>
</html>
