<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - AccountingQuest</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üîß</text></svg>">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: #0f1419; color: #e0e0e0; min-height: 100vh; }
        .header { background: #1a1f26; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #4ade80; }
        .header h1 { color: #4ade80; font-size: 1.5em; }
        .header-actions { display: flex; gap: 15px; align-items: center; }
        .user-info { color: #9ca3af; font-size: 0.9em; }
        .btn { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.2s; font-size: 0.9em; }
        .btn-primary { background: #4ade80; color: #1a1a1a; }
        .btn-secondary { background: #374151; color: #e0e0e0; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-export { background: #3b82f6; color: white; }
        .btn:hover { transform: translateY(-1px); opacity: 0.9; }
        .container { display: flex; min-height: calc(100vh - 70px); }
        .sidebar { width: 220px; background: #1a1f26; border-right: 1px solid #2d333b; padding: 15px 0; }
        .sidebar-item { padding: 12px 20px; cursor: pointer; display: flex; align-items: center; gap: 10px; color: #9ca3af; font-size: 0.95em; }
        .sidebar-item:hover { background: #2d333b; color: #e0e0e0; }
        .sidebar-item.active { background: rgba(74, 222, 128, 0.1); color: #4ade80; border-left: 3px solid #4ade80; }
        .sidebar-section { padding: 10px 20px; font-size: 0.7em; color: #6b7280; text-transform: uppercase; letter-spacing: 1px; margin-top: 15px; }
        .main { flex: 1; padding: 25px; overflow-y: auto; }
        .page { display: none; }
        .page.active { display: block; }
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 15px; }
        .page-title { font-size: 1.6em; color: #4ade80; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .stat-card { background: #1a1f26; border: 1px solid #2d333b; border-radius: 10px; padding: 20px; text-align: center; }
        .stat-value { font-size: 2.2em; font-weight: bold; color: #4ade80; }
        .stat-label { color: #9ca3af; font-size: 0.85em; margin-top: 5px; }
        .data-table { width: 100%; border-collapse: collapse; background: #1a1f26; border-radius: 10px; overflow: hidden; font-size: 0.9em; }
        .data-table th, .data-table td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #2d333b; }
        .data-table th { background: #2d333b; font-weight: 600; color: #4ade80; position: sticky; top: 0; }
        .data-table tr:hover { background: rgba(74, 222, 128, 0.05); }
        .data-table td { max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 6px; color: #9ca3af; font-size: 0.85em; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 10px 12px; background: #2d333b; border: 1px solid #374151; border-radius: 6px; color: #e0e0e0; font-size: 0.95em; }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus { outline: none; border-color: #4ade80; }
        .form-group textarea { min-height: 80px; resize: vertical; font-family: inherit; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0, 0, 0, 0.85); z-index: 1000; align-items: center; justify-content: center; padding: 20px; }
        .modal.show { display: flex; }
        .modal-content { background: #1a1f26; border: 1px solid #2d333b; border-radius: 12px; padding: 25px; max-width: 700px; width: 100%; max-height: 90vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #2d333b; }
        .modal-header h2 { color: #4ade80; font-size: 1.3em; }
        .modal-close { background: none; border: none; color: #9ca3af; font-size: 1.8em; cursor: pointer; line-height: 1; }
        .modal-footer { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; padding-top: 15px; border-top: 1px solid #2d333b; }
        .badge { display: inline-block; padding: 3px 8px; border-radius: 12px; font-size: 0.75em; font-weight: 600; }
        .badge-green { background: rgba(74, 222, 128, 0.2); color: #4ade80; }
        .badge-blue { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
        .badge-orange { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
        .badge-red { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .badge-purple { background: rgba(139, 92, 246, 0.2); color: #8b5cf6; }
        .access-denied { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; text-align: center; }
        .access-denied h1 { font-size: 4em; margin-bottom: 20px; }
        .loading { display: flex; align-items: center; justify-content: center; height: 150px; color: #9ca3af; }
        .spinner { width: 35px; height: 35px; border: 3px solid #2d333b; border-top-color: #4ade80; border-radius: 50%; animation: spin 0.8s linear infinite; margin-right: 12px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .message { padding: 12px 18px; border-radius: 8px; margin-bottom: 15px; font-size: 0.9em; }
        .message.success { background: rgba(74, 222, 128, 0.15); border: 1px solid #4ade80; color: #4ade80; }
        .message.error { background: rgba(239, 68, 68, 0.15); border: 1px solid #ef4444; color: #ef4444; }
        .message.info { background: rgba(59, 130, 246, 0.15); border: 1px solid #3b82f6; color: #3b82f6; }
        .action-btns { display: flex; gap: 6px; }
        .action-btn { padding: 5px 10px; border-radius: 5px; font-size: 0.8em; cursor: pointer; border: none; }
        .action-btn.edit { background: #3b82f6; color: white; }
        .action-btn.delete { background: #ef4444; color: white; }
        .tabs { display: flex; gap: 5px; margin-bottom: 15px; border-bottom: 2px solid #2d333b; flex-wrap: wrap; }
        .tab { padding: 10px 18px; background: none; border: none; color: #9ca3af; cursor: pointer; font-size: 0.9em; }
        .tab.active { color: #4ade80; border-bottom: 2px solid #4ade80; margin-bottom: -2px; }
        .seed-card { background: #1a1f26; border: 1px solid #2d333b; border-radius: 10px; padding: 20px; }
        .seed-card h3 { color: #e0e0e0; margin-bottom: 10px; font-size: 1.1em; }
        .seed-card p { color: #9ca3af; font-size: 0.85em; margin-bottom: 15px; }
        .progress-bar { height: 6px; background: #2d333b; border-radius: 3px; overflow: hidden; margin-top: 10px; }
        .progress-fill { height: 100%; background: #4ade80; transition: width 0.3s; }
        .table-container { max-height: 60vh; overflow-y: auto; border-radius: 10px; }
        @media (max-width: 768px) { 
            .container { flex-direction: column; } 
            .sidebar { width: 100%; display: flex; overflow-x: auto; padding: 10px; border-right: none; border-bottom: 1px solid #2d333b; } 
            .sidebar-section { display: none; }
            .sidebar-item { white-space: nowrap; padding: 10px 15px; }
            .form-row { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div id="access-denied" class="access-denied" style="display: none;">
        <h1>üîí</h1>
        <h2>Ingen tilgang</h2>
        <p style="color: #9ca3af; margin: 20px 0;">Du m√• v√¶re admin for √• f√• tilgang.</p>
        <a href="index.html" class="btn btn-primary">‚Üê Tilbake til forsiden</a>
    </div>

    <div id="loading-screen" class="access-denied">
        <div class="spinner"></div>
        <p>Sjekker tilgang...</p>
    </div>

    <div id="app" style="display: none;">
        <header class="header">
            <h1>üîß Admin Dashboard</h1>
            <div class="header-actions">
                <span class="user-info" id="user-info"></span>
                <a href="index.html" class="btn btn-secondary">‚Üê Tilbake</a>
                <button class="btn btn-danger" onclick="logout()">Logg ut</button>
            </div>
        </header>

        <div class="container">
            <nav class="sidebar">
                <div class="sidebar-item active" onclick="showPage('dashboard', this)">üìä Dashboard</div>
                <div class="sidebar-section">Innhold</div>
                <div class="sidebar-item" onclick="showPage('quiz', this)">‚ùì Quiz (113+)</div>
                <div class="sidebar-item" onclick="showPage('corporate-finance', this)">üíπ Corp. Finance</div>
                <div class="sidebar-item" onclick="showPage('bokforing', this)">üìñ Bokf√∏ring (19)</div>
                <div class="sidebar-item" onclick="showPage('wiki', this)">üìö Wiki</div>
                <div class="sidebar-section">Brukere</div>
                <div class="sidebar-item" onclick="showPage('users', this)">üë• Brukere</div>
                <div class="sidebar-item" onclick="showPage('teachers', this)">üë®‚Äçüè´ L√¶rere</div>
                <div class="sidebar-section">System</div>
                <div class="sidebar-item" onclick="showPage('seeder', this)">üå± Seed Data</div>
                <div class="sidebar-item" onclick="showPage('export', this)">üì§ Eksporter</div>
                <div class="sidebar-item" onclick="showPage('settings', this)">‚öôÔ∏è Innstillinger</div>
            </nav>

            <main class="main">
                <!-- Dashboard -->
                <div id="page-dashboard" class="page active">
                    <div class="page-header"><h2 class="page-title">üìä Dashboard</h2></div>
                    <div class="stats-grid">
                        <div class="stat-card"><div class="stat-value" id="stat-users">-</div><div class="stat-label">Brukere</div></div>
                        <div class="stat-card"><div class="stat-value" id="stat-questions">-</div><div class="stat-label">Quiz</div></div>
                        <div class="stat-card"><div class="stat-value" id="stat-bokforing">-</div><div class="stat-label">Bokf√∏ring</div></div>
                        <div class="stat-card"><div class="stat-value" id="stat-wiki">-</div><div class="stat-label">Wiki</div></div>
                        <div class="stat-card"><div class="stat-value" id="stat-teachers">-</div><div class="stat-label">L√¶rere</div></div>
                        <div class="stat-card"><div class="stat-value" id="stat-classrooms">-</div><div class="stat-label">Klasserom</div></div>
                    </div>
                    <div class="seed-card">
                        <h3>üöÄ Kom i gang</h3>
                        <p>Hvis du ikke har data enn√•, g√• til "Seed Data" og last opp innholdet til Firebase.</p>
                    </div>
                </div>

                <!-- Quiz -->
                <div id="page-quiz" class="page">
                    <div class="page-header">
                        <h2 class="page-title">‚ùì Quiz-sp√∏rsm√•l</h2>
                        <div>
                            <button class="btn btn-export" onclick="exportQuiz()">üì§ Excel</button>
                            <button class="btn btn-primary" onclick="openQuizModal()">+ Legg til</button>
                        </div>
                    </div>
                    <div id="quiz-message"></div>
                    <div class="tabs">
                        <button class="tab active" onclick="filterQuiz('all', this)">Alle</button>
                        <button class="tab" onclick="filterQuiz('regnskap', this)">Regnskap</button>
                        <button class="tab" onclick="filterQuiz('bokforing', this)">Bokf√∏ring</button>
                        <button class="tab" onclick="filterQuiz('mva', this)">MVA</button>
                        <button class="tab" onclick="filterQuiz('skatt', this)">Skatt</button>
                        <button class="tab" onclick="filterQuiz('corporate-finance', this)">Corp. Finance</button>
                        <button class="tab" onclick="filterQuiz('regnskapsanalyse', this)">Analyse</button>
                        <button class="tab" onclick="filterQuiz('driftsregnskap', this)">Driftsregnskap</button>
                    </div>
                    <div class="table-container"><div id="quiz-list" class="loading"><div class="spinner"></div><span>Laster...</span></div></div>
                </div>

                <!-- Bokf√∏ring -->
                <div id="page-bokforing" class="page">
                    <div class="page-header">
                        <h2 class="page-title">üìñ Bokf√∏ringsoppgaver</h2>
                        <div>
                            <button class="btn btn-export" onclick="exportBokforing()">üì§ Excel</button>
                            <button class="btn btn-primary" onclick="openBokforingModal()">+ Legg til</button>
                        </div>
                    </div>
                    <div id="bokforing-message"></div>
                    <div class="tabs">
                        <button class="tab active" onclick="filterBokforing('all', this)">Alle</button>
                        <button class="tab" onclick="filterBokforing('easy', this)">Nybegynner</button>
                        <button class="tab" onclick="filterBokforing('medium', this)">Middels</button>
                        <button class="tab" onclick="filterBokforing('hard', this)">Avansert</button>
                    </div>
                    <div class="table-container"><div id="bokforing-list" class="loading"><div class="spinner"></div><span>Laster...</span></div></div>
                </div>

                <!-- Corporate Finance -->
                <div id="page-corporate-finance" class="page">
                    <div class="page-header">
                        <h2 class="page-title">üíπ Corporate Finance</h2>
                        <div>
                            <button class="btn btn-export" onclick="exportCorporateFinance()">üì§ Excel</button>
                            <button class="btn btn-secondary" onclick="document.getElementById('import-module').value='corporate_finance'; showPage('seeder', document.querySelector('.sidebar-item:nth-child(8)'))">üì• Importer JSON</button>
                        </div>
                    </div>
                    <div id="cf-message"></div>
                    <div class="stats-grid" style="margin-bottom: 20px;">
                        <div class="stat-card"><div class="stat-value" id="cf-stat-total">-</div><div class="stat-label">Totalt</div></div>
                        <div class="stat-card"><div class="stat-value" id="cf-stat-npv">-</div><div class="stat-label">NPV/IRR</div></div>
                        <div class="stat-card"><div class="stat-value" id="cf-stat-wacc">-</div><div class="stat-label">WACC/CAPM</div></div>
                        <div class="stat-card"><div class="stat-value" id="cf-stat-other">-</div><div class="stat-label">Andre</div></div>
                    </div>
                    <div class="tabs">
                        <button class="tab active" onclick="filterCF('all', this)">Alle</button>
                        <button class="tab" onclick="filterCF('npv', this)">NPV</button>
                        <button class="tab" onclick="filterCF('irr', this)">IRR</button>
                        <button class="tab" onclick="filterCF('wacc', this)">WACC</button>
                        <button class="tab" onclick="filterCF('capm', this)">CAPM</button>
                        <button class="tab" onclick="filterCF('bonds', this)">Bonds</button>
                        <button class="tab" onclick="filterCF('portfolio', this)">Portfolio</button>
                        <button class="tab" onclick="filterCF('options', this)">Options</button>
                    </div>
                    <div class="table-container"><div id="cf-list" class="loading"><div class="spinner"></div><span>Laster...</span></div></div>
                </div>

                <!-- Wiki -->
                <div id="page-wiki" class="page">
                    <div class="page-header">
                        <h2 class="page-title">üìö Wiki-artikler</h2>
                        <div>
                            <button class="btn btn-export" onclick="exportWiki()">üì§ Excel</button>
                            <button class="btn btn-primary" onclick="openWikiModal()">+ Legg til</button>
                        </div>
                    </div>
                    <div class="table-container"><div id="wiki-list" class="loading"><div class="spinner"></div><span>Laster...</span></div></div>
                </div>

                <!-- Users -->
                <div id="page-users" class="page">
                    <div class="page-header">
                        <h2 class="page-title">üë• Brukere</h2>
                        <button class="btn btn-export" onclick="exportUsers()">üì§ Excel</button>
                    </div>
                    <div class="table-container"><div id="users-list" class="loading"><div class="spinner"></div><span>Laster...</span></div></div>
                </div>

                <!-- Teachers -->
                <div id="page-teachers" class="page">
                    <div class="page-header"><h2 class="page-title">üë®‚Äçüè´ L√¶rere</h2></div>
                    <div class="table-container"><div id="teachers-list" class="loading"><div class="spinner"></div><span>Laster...</span></div></div>
                </div>

                <!-- Seeder -->
                <div id="page-seeder" class="page">
                    <div class="page-header"><h2 class="page-title">üå± Seed Data til Firebase</h2></div>
                    <div id="seeder-message"></div>
                    <p style="color: #9ca3af; margin-bottom: 20px;">Last opp alle oppgaver fra AccountingQuest til Firebase-databasen.</p>
                    <div class="stats-grid">
                        <div class="seed-card">
                            <h3>‚ùì Quiz-sp√∏rsm√•l</h3>
                            <p><strong>113+</strong> sp√∏rsm√•l i 10+ kategorier</p>
                            <button class="btn btn-primary" onclick="seedQuiz()" id="btn-seed-quiz">üå± Seed Quiz</button>
                            <div class="progress-bar"><div class="progress-fill" id="prog-quiz" style="width:0%"></div></div>
                        </div>
                        <div class="seed-card">
                            <h3>üìñ Bokf√∏ringsoppgaver</h3>
                            <p><strong>19</strong> oppgaver med hint og l√∏sning</p>
                            <button class="btn btn-primary" onclick="seedBokforing()" id="btn-seed-bokforing">üå± Seed Bokf√∏ring</button>
                            <div class="progress-bar"><div class="progress-fill" id="prog-bokforing" style="width:0%"></div></div>
                        </div>
                        <div class="seed-card">
                            <h3>üìö Wiki-artikler</h3>
                            <p><strong>20+</strong> artikler med lovhenvisninger</p>
                            <button class="btn btn-primary" onclick="seedWiki()" id="btn-seed-wiki">üå± Seed Wiki</button>
                            <div class="progress-bar"><div class="progress-fill" id="prog-wiki" style="width:0%"></div></div>
                        </div>
                        <div class="seed-card">
                            <h3>üöÄ Alt p√• en gang</h3>
                            <p>Last opp alt innhold</p>
                            <button class="btn btn-primary" onclick="seedAll()">üöÄ Seed Alt</button>
                        </div>
                    </div>
                    
                    <!-- JSON Import Section -->
                    <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #2d333b;">
                        <h3 style="color: #4ade80; margin-bottom: 20px;">üì• Importer fra JSON-fil</h3>
                        <p style="color: #9ca3af; margin-bottom: 20px;">Last opp JSON-filer med innhold. St√∏tter Quiz, Corporate Finance, Bokf√∏ring og Wiki.</p>
                        
                        <div class="stats-grid">
                            <div class="seed-card">
                                <h3>üìÑ Last opp JSON</h3>
                                <p>Velg modul og last opp fil</p>
                                <div class="form-group">
                                    <label>Modul</label>
                                    <select id="import-module">
                                        <option value="auto">üîÑ Auto-detect</option>
                                        <option value="quiz">‚ùì Quiz</option>
                                        <option value="corporate_finance">üíπ Corporate Finance</option>
                                        <option value="bokforing">üìñ Bokf√∏ring</option>
                                        <option value="wiki">üìö Wiki</option>
                                    </select>
                                </div>
                                <input type="file" id="json-file-input" accept=".json" style="display: none;" onchange="handleJsonFile(event)">
                                <button class="btn btn-primary" onclick="document.getElementById('json-file-input').click()">üìÇ Velg fil</button>
                            </div>
                            <div class="seed-card">
                                <h3>üìã Forh√•ndsvisning</h3>
                                <p id="json-preview-count">Ingen fil valgt</p>
                                <p id="json-detected-module" style="color: #4ade80; font-size: 0.9em;"></p>
                                <button class="btn btn-primary" onclick="importJsonToFirebase()" id="btn-import-json" disabled>‚¨ÜÔ∏è Importer til Firebase</button>
                                <div class="progress-bar"><div class="progress-fill" id="prog-json-import" style="width:0%"></div></div>
                            </div>
                        </div>
                        
                        <div id="json-preview" style="margin-top: 20px; display: none;">
                            <h4 style="color: #9ca3af; margin-bottom: 10px;">Kategorier/Topics funnet:</h4>
                            <div id="json-categories" style="display: flex; flex-wrap: wrap; gap: 10px;"></div>
                            <div class="table-container" style="margin-top: 15px; max-height: 300px;">
                                <table class="data-table" id="json-preview-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Tittel/Sp√∏rsm√•l</th>
                                            <th>Topic/Kategori</th>
                                            <th>Vanskelighet</th>
                                        </tr>
                                    </thead>
                                    <tbody id="json-preview-body"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Download Templates -->
                    <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #2d333b;">
                        <h3 style="color: #4ade80; margin-bottom: 20px;">üìù JSON Maler</h3>
                        <p style="color: #9ca3af; margin-bottom: 15px;">Last ned mal-filer for √• se riktig format:</p>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="btn btn-secondary" onclick="downloadTemplate('corporate_finance')">üíπ Corporate Finance mal</button>
                            <button class="btn btn-secondary" onclick="downloadTemplate('quiz')">‚ùì Quiz mal</button>
                        </div>
                    </div>
                </div>

                <!-- Export -->
                <div id="page-export" class="page">
                    <div class="page-header"><h2 class="page-title">üì§ Eksporter til Excel</h2></div>
                    <p style="color: #9ca3af; margin-bottom: 20px;">Last ned data som Excel-filer.</p>
                    <div class="stats-grid">
                        <div class="seed-card">
                            <h3>‚ùì Quiz</h3>
                            <p>Alle sp√∏rsm√•l med svar og forklaringer</p>
                            <button class="btn btn-export" onclick="exportQuiz()">üì§ Last ned Excel</button>
                        </div>
                        <div class="seed-card">
                            <h3>üìñ Bokf√∏ring</h3>
                            <p>Alle oppgaver med l√∏sninger</p>
                            <button class="btn btn-export" onclick="exportBokforing()">üì§ Last ned Excel</button>
                        </div>
                        <div class="seed-card">
                            <h3>üë• Brukere</h3>
                            <p>Brukerliste med e-post og rolle</p>
                            <button class="btn btn-export" onclick="exportUsers()">üì§ Last ned Excel</button>
                        </div>
                        <div class="seed-card">
                            <h3>üìä Alt</h3>
                            <p>Alle data i √©n fil</p>
                            <button class="btn btn-export" onclick="exportAll()">üì§ Last ned alt</button>
                        </div>
                    </div>
                </div>

                <!-- Settings -->
                <div id="page-settings" class="page">
                    <div class="page-header"><h2 class="page-title">‚öôÔ∏è Innstillinger</h2></div>
                    <div class="seed-card" style="margin-bottom: 20px;">
                        <h3>üîë Legg til admin</h3>
                        <div class="form-group">
                            <label>Bruker UID</label>
                            <input type="text" id="new-admin-uid" placeholder="abc123xyz...">
                        </div>
                        <button class="btn btn-primary" onclick="addAdmin()">Legg til</button>
                    </div>
                    <div class="seed-card" style="margin-bottom: 20px;">
                        <h3>üìã Din UID</h3>
                        <p style="color: #4ade80; font-family: monospace; word-break: break-all; margin-top: 10px;" id="my-uid">-</p>
                    </div>
                    <div class="seed-card">
                        <h3>üóëÔ∏è Slett data</h3>
                        <p style="margin-bottom: 15px;">‚ö†Ô∏è Kan ikke angres!</p>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="btn btn-danger" onclick="clearData('questions')">Slett Quiz</button>
                            <button class="btn btn-danger" onclick="clearData('bokforing')">Slett Bokf√∏ring</button>
                            <button class="btn btn-danger" onclick="clearData('wiki')">Slett Wiki</button>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Quiz Modal -->
    <div class="modal" id="quiz-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="quiz-modal-title">Nytt sp√∏rsm√•l</h2>
                <button class="modal-close" onclick="closeModal('quiz-modal')">&times;</button>
            </div>
            <form onsubmit="saveQuiz(event)">
                <input type="hidden" id="q-id">
                <div class="form-row">
                    <div class="form-group">
                        <label>Type</label>
                        <select id="q-type">
                            <option value="mc">Flervalg (MC)</option>
                            <option value="tf">Sant/Usant (TF)</option>
                            <option value="para">Tekstsvar</option>
                            <option value="multi">Flere svar</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Kategori</label>
                        <select id="q-category">
                            <option value="regnskap">Regnskap</option>
                            <option value="bokforing">Bokf√∏ring</option>
                            <option value="mva">MVA</option>
                            <option value="skatt">Skatt</option>
                            <option value="analyse">Analyse</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Sp√∏rsm√•l</label>
                    <textarea id="q-question" required></textarea>
                </div>
                <div class="form-group">
                    <label>Alternativer (ett per linje, kun for MC/multi)</label>
                    <textarea id="q-options" placeholder="Alternativ 1&#10;Alternativ 2&#10;Alternativ 3&#10;Alternativ 4"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Riktig svar (indeks 0-3 for MC, true/false for TF)</label>
                        <input type="text" id="q-answer" placeholder="0 eller true">
                    </div>
                    <div class="form-group">
                        <label>Lovhenvisning</label>
                        <input type="text" id="q-law" placeholder="¬ß 4-1 (BOKL)">
                    </div>
                </div>
                <div class="form-group">
                    <label>Forklaring</label>
                    <textarea id="q-explanation"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('quiz-modal')">Avbryt</button>
                    <button type="submit" class="btn btn-primary">Lagre</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Bokf√∏ring Modal -->
    <div class="modal" id="bokforing-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="bokforing-modal-title">Ny oppgave</h2>
                <button class="modal-close" onclick="closeModal('bokforing-modal')">&times;</button>
            </div>
            <form onsubmit="saveBokforing(event)">
                <input type="hidden" id="b-id">
                <div class="form-row">
                    <div class="form-group">
                        <label>Oppgavenummer</label>
                        <input type="number" id="b-num" required>
                    </div>
                    <div class="form-group">
                        <label>Vanskelighetsgrad</label>
                        <select id="b-difficulty">
                            <option value="easy">Nybegynner</option>
                            <option value="medium">Middels</option>
                            <option value="hard">Avansert</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Beskrivelse</label>
                    <textarea id="b-description" required></textarea>
                </div>
                <div class="form-group">
                    <label>Hint</label>
                    <textarea id="b-hint"></textarea>
                </div>
                <div class="form-group">
                    <label>Lovhenvisning</label>
                    <input type="text" id="b-law" placeholder="¬ß 5-1 (BOKL)">
                </div>
                <div class="form-group">
                    <label>L√∏sning (JSON)</label>
                    <textarea id="b-solution" style="font-family: monospace; font-size: 0.85em;" placeholder='[{"account":"4000","debit":10000,"credit":0}]'></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('bokforing-modal')">Avbryt</button>
                    <button type="submit" class="btn btn-primary">Lagre</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Wiki Modal -->
    <div class="modal" id="wiki-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="wiki-modal-title">Ny artikkel</h2>
                <button class="modal-close" onclick="closeModal('wiki-modal')">&times;</button>
            </div>
            <form onsubmit="saveWiki(event)">
                <input type="hidden" id="w-id">
                <div class="form-row">
                    <div class="form-group">
                        <label>ID (URL-vennlig)</label>
                        <input type="text" id="w-slug" required placeholder="bilag-dokumentasjon">
                    </div>
                    <div class="form-group">
                        <label>Kategori</label>
                        <select id="w-category">
                            <option value="bokforing">Bokf√∏ring</option>
                            <option value="mva">MVA</option>
                            <option value="skatt">Skatt</option>
                            <option value="regnskap">Regnskap</option>
                            <option value="analyse">Analyse</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Tittel</label>
                    <input type="text" id="w-title" required>
                </div>
                <div class="form-group">
                    <label>Lovhenvisning</label>
                    <input type="text" id="w-lawref" placeholder="¬ß 10 BOKL">
                </div>
                <div class="form-group">
                    <label>Sammendrag</label>
                    <textarea id="w-summary"></textarea>
                </div>
                <div class="form-group">
                    <label>Innhold</label>
                    <textarea id="w-content" style="min-height: 150px;"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('wiki-modal')">Avbryt</button>
                    <button type="submit" class="btn btn-primary">Lagre</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Firebase Config - accountingquest-multiplayer (same as rest of app)
        const firebaseConfig = {
            apiKey: "AIzaSyAPuacYOSf4Hv-h36yA5Hav67SlpIFMIIQ",
            authDomain: "accountingquest-multiplayer.firebaseapp.com",
            databaseURL: "https://accountingquest-multiplayer-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "accountingquest-multiplayer",
            storageBucket: "accountingquest-multiplayer.appspot.com",
            messagingSenderId: "155094858270",
            appId: "1:155094858270:web:abc123"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();
        let currentUser = null;
        let currentFilter = { quiz: 'all', bokforing: 'all', cf: 'all' };
        let allData = { quiz: [], bokforing: [], wiki: [], users: [], teachers: [], cf: [] };

        // Admin UID - hardkodet for sikkerhet
        const ADMIN_UID = '4fmvu6yn2UVB7rxM4L5pJUWnme72';

        // Auth
        auth.onAuthStateChanged(async (user) => {
            if (!user) { window.location.href = 'auth.html'; return; }
            currentUser = user;
            
            // Check admin - by UID (primary check)
            const isAdmin = user.uid === ADMIN_UID;
            
            if (!isAdmin) {
                // Fallback: check admins node
                const adminSnap = await db.ref('admins/' + user.uid).once('value');
                if (!adminSnap.exists()) {
                    document.getElementById('loading-screen').style.display = 'none';
                    document.getElementById('access-denied').style.display = 'flex';
                    return;
                }
            }
            
            document.getElementById('loading-screen').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            document.getElementById('user-info').textContent = user.email;
            document.getElementById('my-uid').textContent = user.uid;
            loadDashboard();
        });

        function logout() { auth.signOut().then(() => window.location.href = 'index.html'); }

        function showPage(pageId, el) {
            document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active'));
            el.classList.add('active');
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-' + pageId).classList.add('active');
            const loaders = { dashboard: loadDashboard, quiz: loadQuiz, bokforing: loadBokforing, wiki: loadWiki, users: loadUsers, teachers: loadTeachers, 'corporate-finance': loadCorporateFinance };
            if (loaders[pageId]) loaders[pageId]();
        }

        // Dashboard
        async function loadDashboard() {
            const paths = ['users', 'questions', 'bokforing', 'wiki', 'teachers', 'classrooms'];
            const results = await Promise.all(paths.map(p => db.ref(p).once('value')));
            document.getElementById('stat-users').textContent = results[0].numChildren();
            document.getElementById('stat-questions').textContent = results[1].numChildren();
            document.getElementById('stat-bokforing').textContent = results[2].numChildren();
            document.getElementById('stat-wiki').textContent = results[3].numChildren();
            document.getElementById('stat-teachers').textContent = results[4].numChildren();
            document.getElementById('stat-classrooms').textContent = results[5].numChildren();
        }

        // Quiz
        async function loadQuiz() {
            const snap = await db.ref('questions').once('value');
            allData.quiz = [];
            snap.forEach(c => allData.quiz.push({ id: c.key, ...c.val() }));
            renderQuiz();
        }

        function filterQuiz(cat, el) {
            document.querySelectorAll('#page-quiz .tab').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
            currentFilter.quiz = cat;
            renderQuiz();
        }

        function renderQuiz() {
            const filtered = currentFilter.quiz === 'all' ? allData.quiz : allData.quiz.filter(q => q.category === currentFilter.quiz);
            document.getElementById('quiz-list').innerHTML = filtered.length ? `
                <table class="data-table">
                    <thead><tr><th>Type</th><th>Kategori</th><th>Sp√∏rsm√•l</th><th>Lov</th><th>Handlinger</th></tr></thead>
                    <tbody>${filtered.map(q => `
                        <tr>
                            <td><span class="badge badge-blue">${q.type}</span></td>
                            <td><span class="badge badge-green">${q.category}</span></td>
                            <td title="${(q.q||'').replace(/"/g, '&quot;')}">${(q.q||'').substring(0,50)}${(q.q||'').length > 50 ? '...' : ''}</td>
                            <td>${q.l||'-'}</td>
                            <td class="action-btns">
                                <button class="action-btn edit" onclick="editQuiz('${q.id}')">‚úèÔ∏è</button>
                                <button class="action-btn delete" onclick="deleteItem('questions','${q.id}','quiz')">üóëÔ∏è</button>
                            </td>
                        </tr>
                    `).join('')}</tbody>
                </table>
            ` : '<p style="color:#9ca3af;padding:20px">Ingen sp√∏rsm√•l funnet. Bruk Seed Data.</p>';
        }

        function openQuizModal(data = null) {
            document.getElementById('quiz-modal-title').textContent = data ? 'Rediger sp√∏rsm√•l' : 'Nytt sp√∏rsm√•l';
            document.getElementById('q-id').value = data?.id || '';
            document.getElementById('q-type').value = data?.type || 'mc';
            document.getElementById('q-category').value = data?.category || 'regnskap';
            document.getElementById('q-question').value = data?.q || '';
            document.getElementById('q-options').value = (data?.opts || []).join('\n');
            document.getElementById('q-answer').value = data?.a !== undefined ? (Array.isArray(data.a) ? data.a.join(',') : data.a) : '';
            document.getElementById('q-law').value = data?.l || '';
            document.getElementById('q-explanation').value = data?.exp || '';
            openModal('quiz-modal');
        }

        function editQuiz(id) {
            const q = allData.quiz.find(x => x.id === id);
            if (q) openQuizModal(q);
        }

        async function saveQuiz(e) {
            e.preventDefault();
            const id = document.getElementById('q-id').value;
            const type = document.getElementById('q-type').value;
            const answerStr = document.getElementById('q-answer').value;
            let answer;
            if (type === 'tf') answer = answerStr === 'true';
            else if (type === 'multi') answer = answerStr.split(',').map(n => parseInt(n.trim()));
            else answer = parseInt(answerStr) || 0;

            const data = {
                type: type,
                category: document.getElementById('q-category').value,
                q: document.getElementById('q-question').value,
                opts: document.getElementById('q-options').value.split('\n').filter(o => o.trim()),
                a: answer,
                l: document.getElementById('q-law').value,
                exp: document.getElementById('q-explanation').value,
                updatedAt: Date.now()
            };

            if (id) await db.ref('questions/' + id).update(data);
            else await db.ref('questions').push({ ...data, createdAt: Date.now() });
            
            closeModal('quiz-modal');
            showMsg('quiz-message', 'Sp√∏rsm√•l lagret!', 'success');
            loadQuiz();
        }

        // Bokf√∏ring
        async function loadBokforing() {
            const snap = await db.ref('bokforing').once('value');
            allData.bokforing = [];
            snap.forEach(c => allData.bokforing.push({ id: c.key, ...c.val() }));
            allData.bokforing.sort((a, b) => (a.num || 0) - (b.num || 0));
            renderBokforing();
        }

        function filterBokforing(diff, el) {
            document.querySelectorAll('#page-bokforing .tab').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
            currentFilter.bokforing = diff;
            renderBokforing();
        }

        function renderBokforing() {
            const filtered = currentFilter.bokforing === 'all' ? allData.bokforing : allData.bokforing.filter(b => b.difficulty === currentFilter.bokforing);
            const diffBadge = d => d === 'easy' ? 'badge-green' : d === 'medium' ? 'badge-orange' : 'badge-red';
            const diffText = d => d === 'easy' ? 'Nybegynner' : d === 'medium' ? 'Middels' : 'Avansert';
            document.getElementById('bokforing-list').innerHTML = filtered.length ? `
                <table class="data-table">
                    <thead><tr><th>#</th><th>Niv√•</th><th>Beskrivelse</th><th>Lov</th><th>Handlinger</th></tr></thead>
                    <tbody>${filtered.map(b => `
                        <tr>
                            <td>${b.num || '-'}</td>
                            <td><span class="badge ${diffBadge(b.difficulty)}">${diffText(b.difficulty)}</span></td>
                            <td title="${(b.description||'').replace(/"/g, '&quot;')}">${(b.description||'').substring(0,60)}...</td>
                            <td>${b.law||'-'}</td>
                            <td class="action-btns">
                                <button class="action-btn edit" onclick="editBokforing('${b.id}')">‚úèÔ∏è</button>
                                <button class="action-btn delete" onclick="deleteItem('bokforing','${b.id}','bokforing')">üóëÔ∏è</button>
                            </td>
                        </tr>
                    `).join('')}</tbody>
                </table>
            ` : '<p style="color:#9ca3af;padding:20px">Ingen oppgaver funnet. Bruk Seed Data.</p>';
        }

        function openBokforingModal(data = null) {
            document.getElementById('bokforing-modal-title').textContent = data ? 'Rediger oppgave' : 'Ny oppgave';
            document.getElementById('b-id').value = data?.id || '';
            document.getElementById('b-num').value = data?.num || (allData.bokforing.length + 1);
            document.getElementById('b-difficulty').value = data?.difficulty || 'easy';
            document.getElementById('b-description').value = data?.description || '';
            document.getElementById('b-hint').value = data?.hint || '';
            document.getElementById('b-law').value = data?.law || '';
            document.getElementById('b-solution').value = data?.solution ? JSON.stringify(data.solution, null, 2) : '';
            openModal('bokforing-modal');
        }

        function editBokforing(id) {
            const b = allData.bokforing.find(x => x.id === id);
            if (b) openBokforingModal(b);
        }

        async function saveBokforing(e) {
            e.preventDefault();
            const id = document.getElementById('b-id').value;
            let solution = [];
            try { solution = JSON.parse(document.getElementById('b-solution').value || '[]'); } catch(e) {}
            
            const data = {
                num: parseInt(document.getElementById('b-num').value),
                difficulty: document.getElementById('b-difficulty').value,
                description: document.getElementById('b-description').value,
                hint: document.getElementById('b-hint').value,
                law: document.getElementById('b-law').value,
                solution: solution,
                updatedAt: Date.now()
            };

            if (id) await db.ref('bokforing/' + id).update(data);
            else await db.ref('bokforing').push({ ...data, createdAt: Date.now() });
            
            closeModal('bokforing-modal');
            showMsg('bokforing-message', 'Oppgave lagret!', 'success');
            loadBokforing();
        }

        // Corporate Finance
        async function loadCorporateFinance() {
            try {
                const snap = await db.ref('questions/corporate_finance').once('value');
                allData.cf = [];
                
                // Parse nested structure: topic/difficulty/id
                snap.forEach(topicSnap => {
                    const topic = topicSnap.key;
                    topicSnap.forEach(diffSnap => {
                        const difficulty = diffSnap.key;
                        diffSnap.forEach(qSnap => {
                            allData.cf.push({
                                id: qSnap.key,
                                topic: topic,
                                difficulty: difficulty,
                                ...qSnap.val()
                            });
                        });
                    });
                });
                
                // Update stats
                document.getElementById('cf-stat-total').textContent = allData.cf.length;
                document.getElementById('cf-stat-npv').textContent = allData.cf.filter(q => q.topic === 'npv' || q.topic === 'irr').length;
                document.getElementById('cf-stat-wacc').textContent = allData.cf.filter(q => q.topic === 'wacc' || q.topic === 'capm').length;
                document.getElementById('cf-stat-other').textContent = allData.cf.filter(q => !['npv','irr','wacc','capm'].includes(q.topic)).length;
                
                renderCF();
            } catch (e) {
                console.error('Error loading CF:', e);
                document.getElementById('cf-list').innerHTML = '<p style="color:#ef4444;padding:20px">Feil ved lasting: ' + e.message + '</p>';
            }
        }

        function filterCF(topic, el) {
            document.querySelectorAll('#page-corporate-finance .tab').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
            currentFilter.cf = topic;
            renderCF();
        }

        function renderCF() {
            const filtered = currentFilter.cf === 'all' ? allData.cf : allData.cf.filter(q => q.topic === currentFilter.cf);
            const diffBadge = d => d === 'easy' ? 'badge-green' : d === 'medium' ? 'badge-orange' : 'badge-red';
            const typeBadge = t => t === 'calculation' ? 'badge-purple' : 'badge-blue';
            
            document.getElementById('cf-list').innerHTML = filtered.length ? `
                <table class="data-table">
                    <thead><tr><th>ID</th><th>Tittel</th><th>Topic</th><th>Type</th><th>Niv√•</th><th>Handlinger</th></tr></thead>
                    <tbody>${filtered.map(q => `
                        <tr>
                            <td><code style="font-size:0.8em">${q.id}</code></td>
                            <td title="${(q.title||'').replace(/"/g, '&quot;')}">${(q.title||'').substring(0,40)}${(q.title||'').length > 40 ? '...' : ''}</td>
                            <td><span class="badge badge-blue">${q.topic}</span></td>
                            <td><span class="badge ${typeBadge(q.type)}">${q.type === 'calculation' ? 'üßÆ Calc' : 'üìù MC'}</span></td>
                            <td><span class="badge ${diffBadge(q.difficulty)}">${q.difficulty}</span></td>
                            <td class="action-btns">
                                <button class="action-btn delete" onclick="deleteCFQuestion('${q.topic}','${q.difficulty}','${q.id}')">üóëÔ∏è</button>
                            </td>
                        </tr>
                    `).join('')}</tbody>
                </table>
            ` : '<p style="color:#9ca3af;padding:20px">Ingen oppgaver funnet. Bruk "Importer JSON" for √• laste opp corporate-finance-data.json</p>';
        }

        async function deleteCFQuestion(topic, difficulty, id) {
            if (!confirm(`Slett oppgave ${id}?`)) return;
            try {
                await db.ref(`questions/corporate_finance/${topic}/${difficulty}/${id}`).remove();
                await db.ref(`solutions/corporate_finance/${id}`).remove();
                showMsg('cf-message', 'Oppgave slettet!', 'success');
                loadCorporateFinance();
            } catch (e) {
                showMsg('cf-message', 'Feil: ' + e.message, 'error');
            }
        }

        function exportCorporateFinance() {
            if (!allData.cf.length) {
                alert('Ingen data √• eksportere. Last inn Corporate Finance-siden f√∏rst.');
                return;
            }
            const ws = XLSX.utils.json_to_sheet(allData.cf.map(q => ({
                ID: q.id,
                Topic: q.topic,
                Difficulty: q.difficulty,
                Type: q.type,
                Title: q.title,
                Question: q.question,
                Source: q.source
            })));
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Corporate Finance');
            XLSX.writeFile(wb, 'corporate-finance-export.xlsx');
        }

        // Wiki
        async function loadWiki() {
            const snap = await db.ref('wiki').once('value');
            allData.wiki = [];
            snap.forEach(c => allData.wiki.push({ id: c.key, ...c.val() }));
            document.getElementById('wiki-list').innerHTML = allData.wiki.length ? `
                <table class="data-table">
                    <thead><tr><th>ID</th><th>Tittel</th><th>Kategori</th><th>Lov</th><th>Handlinger</th></tr></thead>
                    <tbody>${allData.wiki.map(w => `
                        <tr>
                            <td><code>${w.id}</code></td>
                            <td>${w.title}</td>
                            <td><span class="badge badge-blue">${w.category||'-'}</span></td>
                            <td>${w.lawRef||'-'}</td>
                            <td class="action-btns">
                                <button class="action-btn edit" onclick="editWiki('${w.id}')">‚úèÔ∏è</button>
                                <button class="action-btn delete" onclick="deleteItem('wiki','${w.id}','wiki')">üóëÔ∏è</button>
                            </td>
                        </tr>
                    `).join('')}</tbody>
                </table>
            ` : '<p style="color:#9ca3af;padding:20px">Ingen artikler funnet. Bruk Seed Data.</p>';
        }

        function openWikiModal(data = null) {
            document.getElementById('wiki-modal-title').textContent = data ? 'Rediger artikkel' : 'Ny artikkel';
            document.getElementById('w-id').value = data?.id || '';
            document.getElementById('w-slug').value = data?.id || '';
            document.getElementById('w-category').value = data?.category || 'bokforing';
            document.getElementById('w-title').value = data?.title || '';
            document.getElementById('w-lawref').value = data?.lawRef || '';
            document.getElementById('w-summary').value = data?.summary || '';
            document.getElementById('w-content').value = data?.content || '';
            openModal('wiki-modal');
        }

        function editWiki(id) {
            const w = allData.wiki.find(x => x.id === id);
            if (w) openWikiModal(w);
        }

        async function saveWiki(e) {
            e.preventDefault();
            const oldId = document.getElementById('w-id').value;
            const newId = document.getElementById('w-slug').value;
            
            const data = {
                title: document.getElementById('w-title').value,
                category: document.getElementById('w-category').value,
                lawRef: document.getElementById('w-lawref').value,
                summary: document.getElementById('w-summary').value,
                content: document.getElementById('w-content').value,
                updatedAt: Date.now()
            };

            if (oldId && oldId !== newId) await db.ref('wiki/' + oldId).remove();
            await db.ref('wiki/' + newId).set({ ...data, createdAt: Date.now() });
            
            closeModal('wiki-modal');
            loadWiki();
        }

        // Users & Teachers
        async function loadUsers() {
            const snap = await db.ref('users').limitToLast(100).once('value');
            allData.users = [];
            snap.forEach(c => allData.users.push({ id: c.key, ...c.val() }));
            document.getElementById('users-list').innerHTML = `
                <table class="data-table">
                    <thead><tr><th>Brukernavn</th><th>E-post</th><th>Rolle</th><th>Opprettet</th></tr></thead>
                    <tbody>${allData.users.reverse().map(u => `
                        <tr>
                            <td>${u.username||u.displayName||'-'}</td>
                            <td>${u.email||'-'}</td>
                            <td><span class="badge ${u.role==='teacher'?'badge-purple':'badge-green'}">${u.role||'student'}</span></td>
                            <td>${u.createdAt ? new Date(u.createdAt).toLocaleDateString('no-NO') : '-'}</td>
                        </tr>
                    `).join('')}</tbody>
                </table>
            `;
        }

        async function loadTeachers() {
            const snap = await db.ref('teachers').once('value');
            allData.teachers = [];
            snap.forEach(c => allData.teachers.push({ id: c.key, ...c.val() }));
            document.getElementById('teachers-list').innerHTML = allData.teachers.length ? `
                <table class="data-table">
                    <thead><tr><th>Navn</th><th>E-post</th><th>Skole</th><th>Plan</th><th>Status</th></tr></thead>
                    <tbody>${allData.teachers.map(t => `
                        <tr>
                            <td>${t.name||'-'}</td>
                            <td>${t.email||'-'}</td>
                            <td>${t.school||'-'}</td>
                            <td><span class="badge badge-blue">${t.subscription?.plan||'lite'}</span></td>
                            <td><span class="badge ${t.verified?'badge-green':'badge-orange'}">${t.verified?'Verifisert':'Venter'}</span></td>
                        </tr>
                    `).join('')}</tbody>
                </table>
            ` : '<p style="color:#9ca3af;padding:20px">Ingen l√¶rere registrert.</p>';
        }

        // Helpers
        function openModal(id) { document.getElementById(id).classList.add('show'); }
        function closeModal(id) { document.getElementById(id).classList.remove('show'); }
        function showMsg(elId, msg, type) {
            document.getElementById(elId).innerHTML = `<div class="message ${type}">${msg}</div>`;
            setTimeout(() => document.getElementById(elId).innerHTML = '', 4000);
        }

        async function deleteItem(path, id, reloadFn) {
            if (!confirm('Slette?')) return;
            await db.ref(path + '/' + id).remove();
            if (reloadFn === 'quiz') loadQuiz();
            else if (reloadFn === 'bokforing') loadBokforing();
            else if (reloadFn === 'wiki') loadWiki();
        }

        async function addAdmin() {
            const uid = document.getElementById('new-admin-uid').value.trim();
            if (!uid) return alert('Skriv inn UID');
            await db.ref('admins/' + uid).set({ addedBy: currentUser.uid, addedAt: Date.now() });
            alert('Admin lagt til!');
            document.getElementById('new-admin-uid').value = '';
        }

        async function clearData(path) {
            if (!confirm(`Slette ALT fra "${path}"? KAN IKKE ANGRES!`)) return;
            await db.ref(path).remove();
            alert('Slettet!');
            loadDashboard();
        }

        // ============================================
        // SEEDING - ALL DATA
        // ============================================
        async function seedQuiz() {
            const prog = document.getElementById('prog-quiz');
            prog.style.width = '10%';
            
            const questions = [
                // REGNSKAP (25+)
                {type:"para",category:"regnskap",q:"I hvilken paragraf i regnskapsloven finner du definisjonen av √•rsregnskap?",a:"¬ß 1-2 (RSKL)",variations:["¬ß1-2","¬ß 1-2","1-2"],l:"¬ß 1-2 (RSKL)",exp:"¬ß 1-2 definerer √•rsregnskap og regnskapsplikt."},
                {type:"mc",category:"regnskap",q:"Hva best√•r √•rsregnskapet av?",opts:["Kun resultatregnskap og balanse","Resultatregnskap, balanse og noter","Resultatregnskap, balanse, kontantstr√∏m og noter","Kun balansen"],a:2,l:"¬ß 3-2 (RSKL)",exp:"√Örsregnskapet best√•r av resultat, balanse, kontantstr√∏m og noter."},
                {type:"tf",category:"regnskap",q:"Balanselikningen er Eiendeler = Egenkapital + Gjeld",a:true,l:"¬ß 4-1 (RSKL)",exp:"Korrekt. Alt selskapet eier er finansiert av eiere eller kreditorer."},
                {type:"multi",category:"regnskap",q:"Hvilke av f√∏lgende er oml√∏psmidler?",opts:["Varelager","Kundefordringer","Bygninger","Kontanter","Maskiner"],a:[0,1,3],l:"¬ß 5-1 (RSKL)",exp:"Oml√∏psmidler inkluderer varer, fordringer og kontanter."},
                {type:"mc",category:"regnskap",q:"Hva er forskjellen mellom resultatregnskap og balanse?",opts:["Resultatregnskapet viser status","Balansen viser endringer","Resultatregnskapet viser endringer over en periode","De viser det samme"],a:2,l:"¬ß 6-1 (RSKL)",exp:"Resultat viser endringer, balanse viser status."},
                {type:"tf",category:"regnskap",q:"Goodwill er en immateriell eiendel",a:true,l:"¬ß 5-3 (RSKL)",exp:"Goodwill oppst√•r ved oppkj√∏p og er immateriell."},
                {type:"mc",category:"regnskap",q:"Hva er forsiktighetsprinsippet?",opts:["V√¶r forsiktig med tall","Urealisert tap resultatf√∏res, gevinst ikke","Forsikre eiendeler","V√¶r n√∏yaktig"],a:1,l:"¬ß 4-1 (RSKL)",exp:"Tap tas med en gang, gevinst venter til realisert."},
                {type:"tf",category:"regnskap",q:"Alle foretak m√• ha revisor",a:false,l:"¬ß 7-1 (RSKL)",exp:"Sm√• foretak kan velge bort revisjonsplikt."},
                {type:"mc",category:"regnskap",q:"Hva er kundefordringer?",opts:["Penger vi skylder","Penger kunder skylder oss","Forskudd fra kunder","Kundel√•n"],a:1,l:"¬ß 5-1 (RSKL)",exp:"Kundefordringer er penger kunder skylder oss."},
                {type:"mc",category:"regnskap",q:"Hva er en avsetning?",opts:["Penger p√• bankkonto","Forventet fremtidig forpliktelse","Egenkapital","Inntekt"],a:1,l:"¬ß 5-9 (RSKL)",exp:"Avsetning er usikker forpliktelse mht bel√∏p eller tid."},
                {type:"tf",category:"regnskap",q:"Avskrivninger p√•virker kontantstr√∏mmen direkte",a:false,l:"¬ß 5-3 (RSKL)",exp:"Avskrivninger er kostnader, ikke utgifter."},
                {type:"mc",category:"regnskap",q:"Hva er transaksjonsprinsippet?",opts:["Betal kontant","Regnskapet bygger p√• transaksjoner","Revisor godkjenner","Kun store bokf√∏res"],a:1,l:"¬ß 4-1 (RSKL)",exp:"Regnskapet skal bygge p√• faktiske transaksjoner."},
                {type:"mc",category:"regnskap",q:"Hva er p√•l√∏pte kostnader?",opts:["Betalt, ikke opptjent","Opptjent, ikke betalt","Alle kostnader","Kun variable"],a:1,l:"¬ß 5-7 (RSKL)",exp:"P√•l√∏pte kostnader tilh√∏rer perioden men er ikke betalt."},
                {type:"tf",category:"regnskap",q:"Forskuddsbetalte kostnader er en eiendel",a:true,l:"¬ß 5-1 (RSKL)",exp:"Forskuddsbetalt husleie er en eiendel."},
                {type:"mc",category:"regnskap",q:"Hva er forskjellen mellom kostnad og utgift?",opts:["Ingen forskjell","Kostnad p√•virker resultat, utgift kontantstr√∏m","Utgift er st√∏rre","Kostnad kun varekj√∏p"],a:1,l:"GRS",exp:"Kostnad resultatf√∏res, utgift er betaling."},
                
                // BOKF√òRING (20+)
                {type:"mc",category:"bokforing",q:"Hvor lenge skal bilag oppbevares?",opts:["3 √•r","5 √•r","7 √•r","10 √•r"],a:1,l:"¬ß 13 (BOKL)",exp:"Bilag skal oppbevares i 5 √•r."},
                {type:"tf",category:"bokforing",q:"Alle transaksjoner m√• dokumenteres med bilag",a:true,l:"¬ß 10 (BOKL)",exp:"Bilagskravet er fundamentalt."},
                {type:"mc",category:"bokforing",q:"Hva er korrekt bokf√∏ringsdato for vareleveranse?",opts:["Ordredato","Leveringsdato","Fakturadato","Betalingsdato"],a:1,l:"¬ß 7 (BOKL)",exp:"Bokf√∏ring skjer ved levering."},
                {type:"mc",category:"bokforing",q:"N√•r √∏ker en eiendel?",opts:["Ved kreditering","Ved debitering","Begge","Ingen"],a:1,l:"GBS",exp:"Eiendeler √∏ker p√• debetsiden."},
                {type:"mc",category:"bokforing",q:"Hvilken konto debiteres ved varekj√∏p?",opts:["Leverand√∏rgjeld","Varekostnad","Salgsinntekt","Bank"],a:1,l:"¬ß 5-1 (BOKL)",exp:"Varekostnad debiteres."},
                {type:"tf",category:"bokforing",q:"Elektronisk bokf√∏ring m√• ha sikkerhetskopi",a:true,l:"¬ß 6-1 (BOKL)",exp:"Elektroniske regnskaper m√• sikkerhetskoperes."},
                {type:"mc",category:"bokforing",q:"Hva bokf√∏res p√• konto 1920?",opts:["Kasse","Bankinnskudd","Kundefordringer","Leverand√∏rgjeld"],a:1,l:"NS 4102",exp:"1920 er bankinnskudd."},
                {type:"mc",category:"bokforing",q:"Hvilken konto krediteres ved salg p√• kreditt?",opts:["Kundefordringer","Bank","Salgsinntekt","Varekostnad"],a:2,l:"¬ß 5-1 (BOKL)",exp:"Salgsinntekt krediteres."},
                {type:"tf",category:"bokforing",q:"Debet betyr alltid √∏kning",a:false,l:"GBS",exp:"Debet √∏ker eiendeler/kostnader, reduserer gjeld/inntekter."},
                {type:"mc",category:"bokforing",q:"Hva er en kontoplan?",opts:["Liste over bankkontoer","Systematisk kontooversikt","Budsjettplan","Revisjonsplan"],a:1,l:"¬ß 4-1 (BOKL)",exp:"Kontoplan er oversikt over alle kontoer."},
                {type:"mc",category:"bokforing",q:"Hvilken kontoklass er kostnader?",opts:["1000-1999","3000-3999","4000-7999","8000-8999"],a:2,l:"NS 4102",exp:"Kontoklass 4-7 er kostnader."},
                {type:"mc",category:"bokforing",q:"Hva er et bilag?",opts:["Bankkonto","Dokumentasjon av transaksjon","Regnskapsrapport","Budsjett"],a:1,l:"¬ß 10 (BOKL)",exp:"Bilag dokumenterer transaksjoner."},
                {type:"mc",category:"bokforing",q:"Hvilken kontoklass er eiendeler?",opts:["1000-1999","2000-2999","3000-3999","4000-7999"],a:0,l:"NS 4102",exp:"Kontoklass 1 er eiendeler."},
                {type:"tf",category:"bokforing",q:"Alle norske selskaper m√• bruke NS 4102",a:false,l:"¬ß 4-1 (BOKL)",exp:"Det er standard, men ikke lovp√•lagt."},
                {type:"mc",category:"bokforing",q:"Hva er en saldobalanse?",opts:["Bankbalanse","Oversikt over alle kontoers saldo","Kundeliste","Budsjett"],a:1,l:"GBS",exp:"Saldobalanse viser alle kontoers saldo."},
                
                // MVA (15+)
                {type:"mc",category:"mva",q:"Hva er standard MVA-sats i Norge?",opts:["15%","20%","25%","27%"],a:2,l:"¬ß 5-1 (MVAL)",exp:"Alminnelig sats er 25%."},
                {type:"tf",category:"mva",q:"Matvarer har 15% MVA",a:true,l:"¬ß 5-2 (MVAL)",exp:"N√¶ringsmidler har 15%."},
                {type:"mc",category:"mva",q:"N√•r leveres MVA-oppgaven?",opts:["M√•nedlig","Annenhver m√•ned","Kvartalsvis","√Örlig"],a:1,l:"¬ß 15-8 (MVAL)",exp:"Terminoppgaven er annenhver m√•ned."},
                {type:"mc",category:"mva",q:"Hva er inng√•ende MVA?",opts:["MVA vi krever inn","MVA vi betaler ved kj√∏p","MVA-gjeld","Grunnlag"],a:1,l:"¬ß 8-1 (MVAL)",exp:"Inng√•ende MVA er p√• v√•re kj√∏p."},
                {type:"mc",category:"mva",q:"Hva er utg√•ende MVA?",opts:["MVA ved kj√∏p","MVA vi legger p√• ved salg","MVA-fordring","Grunnlag"],a:1,l:"¬ß 3-1 (MVAL)",exp:"Utg√•ende MVA legges p√• ved salg."},
                {type:"tf",category:"mva",q:"Helsetjenester er MVA-pliktige",a:false,l:"¬ß 3-2 (MVAL)",exp:"Helsetjenester er unntatt."},
                {type:"mc",category:"mva",q:"Hva er MVA-grunnlaget?",opts:["Pris inkl. mva","Pris eksl. mva","Fortjeneste","Varekostnad"],a:1,l:"¬ß 4-1 (MVAL)",exp:"MVA beregnes av pris uten MVA."},
                {type:"mc",category:"mva",q:"Hvilken sats har persontransport?",opts:["0%","12%","15%","25%"],a:1,l:"¬ß 5-3 (MVAL)",exp:"Persontransport har 12%."},
                {type:"tf",category:"mva",q:"Eksport er avgiftspliktig med 0%",a:true,l:"¬ß 6-21 (MVAL)",exp:"Eksport er fritatt men gir fradrag."},
                {type:"mc",category:"mva",q:"N√•r m√• man registreres for MVA?",opts:["Straks","Over 50.000","Over 100.000","Aldri"],a:1,l:"¬ß 2-1 (MVAL)",exp:"Grensen er 50.000 kr."},
                {type:"mc",category:"mva",q:"Hva er MVA-oppgj√∏r?",opts:["Beregning av resultat","Differanse utg. og inng. mva","Skatteberegning","√Örsregnskap"],a:1,l:"¬ß 11-1 (MVAL)",exp:"Oppgj√∏r er differansen som betales/mottas."},
                {type:"tf",category:"mva",q:"Finanstjenester har 25% MVA",a:false,l:"¬ß 3-6 (MVAL)",exp:"Finanstjenester er unntatt."},
                
                // SKATT (15+)
                {type:"mc",category:"skatt",q:"Hva er selskapsskattesatsen?",opts:["20%","22%","24%","27%"],a:1,l:"SKTL",exp:"Satsen er 22%."},
                {type:"tf",category:"skatt",q:"AS er fritatt formueskatt",a:true,l:"¬ß 2-36 (SKTL)",exp:"Kun personlige eiere betaler."},
                {type:"mc",category:"skatt",q:"Hva er utsatt skatt?",opts:["Skatt neste √•r","Skatt p√• midlertidige forskjeller","Skatt man slipper","Forskuddsskatt"],a:1,l:"¬ß 5-14 (RSKL)",exp:"Utsatt skatt er p√• midlertidige forskjeller."},
                {type:"tf",category:"skatt",q:"Regnskapsmessig og skattemessig resultat er alltid likt",a:false,l:"SKTL",exp:"Det er ofte forskjeller."},
                {type:"mc",category:"skatt",q:"Hva er fradragsberettiget?",opts:["Private utgifter","Kostnader til inntektserverv","Gaver til familie","B√∏ter"],a:1,l:"¬ß 6-1 (SKTL)",exp:"Kostnader til √• erverve inntekt."},
                {type:"mc",category:"skatt",q:"Avskrivningssats for maskiner (saldogruppe d)?",opts:["10%","20%","30%","40%"],a:1,l:"¬ß 14-43 (SKTL)",exp:"Saldogruppe d har 20%."},
                {type:"tf",category:"skatt",q:"Representasjon er fullt fradragsberettiget",a:false,l:"¬ß 6-21 (SKTL)",exp:"Bare 50% er fradragsberettiget."},
                {type:"mc",category:"skatt",q:"Frist for selvangivelse AS?",opts:["31. mars","30. april","31. mai","30. juni"],a:2,l:"Skatteforvaltningsloven",exp:"Fristen er 31. mai."},
                {type:"mc",category:"skatt",q:"Hva er permanente forskjeller?",opts:["Forskjeller som reverserer","Forskjeller som aldri reverserer","Midlertidige forskjeller","Ingen forskjeller"],a:1,l:"SKTL",exp:"Permanente forskjeller reverserer aldri."},
                {type:"mc",category:"skatt",q:"Hva er skattepliktig inntekt?",opts:["Regnskapsmessig resultat","Resultat etter skattemessige justeringer","Omsetning","Bruttofortjeneste"],a:1,l:"¬ß 5-1 (SKTL)",exp:"Skattepliktig inntekt er justert resultat."},
                
                // ANALYSE (10+)
                {type:"mc",category:"analyse",q:"Hva m√•ler likviditetsgrad 1?",opts:["L√∏nnsomhet","Evne til √• betale kortsiktig gjeld","Soliditet","Effektivitet"],a:1,l:"GRS",exp:"LG1 = Oml√∏psmidler / Kortsiktig gjeld."},
                {type:"mc",category:"analyse",q:"Formel for egenkapitalandel?",opts:["EK/Gjeld","EK/Totalkapital","Gjeld/EK","Resultat/EK"],a:1,l:"GRS",exp:"Egenkapitalandel = EK / Totalkapital."},
                {type:"tf",category:"analyse",q:"H√∏y gjeldsgrad er alltid negativt",a:false,l:"GRS",exp:"H√∏y gjeldsgrad gir risiko men ogs√• potensiale."},
                {type:"mc",category:"analyse",q:"Hva er ROE?",opts:["Return on Equity","Rate of Exchange","Return on Expenses","Risk of Equity"],a:0,l:"GRS",exp:"ROE = Resultat / Egenkapital."},
                {type:"mc",category:"analyse",q:"Hva viser totalkapitalrentabilitet?",opts:["Avkastning p√• all kapital","Bare egenkapital","Bare gjeld","Omsetning"],a:0,l:"GRS",exp:"TKR viser avkastning p√• all kapital."},
                {type:"mc",category:"analyse",q:"Hva er horisontal analyse?",opts:["Sammenligning over tid","Sammenligning med andre","Prosent av total","N√∏kkeltall"],a:0,l:"GRS",exp:"Horisontal analyse sammenligner over tid."},
                {type:"mc",category:"analyse",q:"Hva er vertikal analyse?",opts:["Sammenligning over tid","Hver post som prosent av total","Sammenligning med andre","Trendanalyse"],a:1,l:"GRS",exp:"Vertikal analyse viser prosent av total."},
                {type:"mc",category:"analyse",q:"Hva er god likviditetsgrad 1?",opts:["Under 1","1,0-1,5","Over 1,5","Over 3"],a:2,l:"GRS",exp:"LG1 b√∏r v√¶re over 1,5."},
                {type:"mc",category:"analyse",q:"Hva viser gjeldsgrad?",opts:["Gjeld / EK","EK / Gjeld","Gjeld / Omsetning","EK / Totalkapital"],a:0,l:"GRS",exp:"Gjeldsgrad = Gjeld / Egenkapital."}
            ];
            
            prog.style.width = '50%';
            const batch = {};
            questions.forEach((q, i) => batch['q_' + Date.now() + '_' + i] = {...q, createdAt: Date.now()});
            await db.ref('questions').update(batch);
            prog.style.width = '100%';
            showMsg('seeder-message', `‚úÖ ${questions.length} quiz-sp√∏rsm√•l lastet opp!`, 'success');
            loadDashboard();
        }

        async function seedBokforing() {
            const prog = document.getElementById('prog-bokforing');
            prog.style.width = '10%';
            
            const exercises = [
                {num:1,difficulty:"easy",description:"Kj√∏per varer for kr 10 000 + mva 25% = kr 12 500 p√• kreditt.",hint:"Varekostnad og inng√•ende mva debiteres. Leverand√∏rgjeld krediteres.",solution:[{account:"4000",debit:10000,credit:0},{account:"2710",debit:2500,credit:0},{account:"2400",debit:0,credit:12500}],law:"¬ß 5-1 (BOKL)"},
                {num:2,difficulty:"easy",description:"Selger varer for kr 20 000 + mva 25% = kr 25 000 p√• faktura.",hint:"Kundefordring debiteres. Salgsinntekt og utg√•ende mva krediteres.",solution:[{account:"1500",debit:25000,credit:0},{account:"3000",debit:0,credit:20000},{account:"2700",debit:0,credit:5000}],law:"¬ß 5-1 (BOKL)"},
                {num:3,difficulty:"easy",description:"Mottar betaling fra kunde p√• kr 15 000.",hint:"Bankinnskudd √∏ker (debet), kundefordring reduseres (kredit).",solution:[{account:"1920",debit:15000,credit:0},{account:"1500",debit:0,credit:15000}],law:"¬ß 7 (BOKL)"},
                {num:4,difficulty:"easy",description:"Betaler leverand√∏r kr 8 000.",hint:"Leverand√∏rgjeld reduseres (debet), bankinnskudd reduseres (kredit).",solution:[{account:"2400",debit:8000,credit:0},{account:"1920",debit:0,credit:8000}],law:"¬ß 7 (BOKL)"},
                {num:5,difficulty:"medium",description:"Betaler l√∏nn kr 30 000. Skattetrekk 30% = kr 9 000. Netto = kr 21 000.",hint:"L√∏nn debiteres, skattetrekk og nettoutbetaling krediteres.",solution:[{account:"5000",debit:30000,credit:0},{account:"2600",debit:0,credit:9000},{account:"1920",debit:0,credit:21000}],law:"¬ß 5-1 (BOKL)"},
                {num:6,difficulty:"medium",description:"Beregner AGA 14,1% av l√∏nn kr 30 000 = kr 4 230.",hint:"AGA (kostnad) debiteres, skyldig AGA (gjeld) krediteres.",solution:[{account:"5400",debit:4230,credit:0},{account:"2770",debit:0,credit:4230}],law:"Folketrygdloven"},
                {num:7,difficulty:"medium",description:"Kj√∏per kontorm√∏bler for kr 15 000 + mva = kr 18 750 kontant.",hint:"Inventar debiteres, inng√•ende mva debiteres, bank krediteres.",solution:[{account:"1200",debit:15000,credit:0},{account:"2710",debit:3750,credit:0},{account:"1920",debit:0,credit:18750}],law:"¬ß 5-1 (BOKL)"},
                {num:8,difficulty:"medium",description:"Avskriver maskiner med kr 5 000 for √•ret.",hint:"Avskrivning (kostnad) debiteres, eiendel krediteres.",solution:[{account:"6020",debit:5000,credit:0},{account:"1200",debit:0,credit:5000}],law:"¬ß 5-3 (RSKL)"},
                {num:9,difficulty:"medium",description:"Tar opp l√•n i bank p√• kr 100 000.",hint:"Bankinnskudd √∏ker, gjeld til bank √∏ker.",solution:[{account:"1920",debit:100000,credit:0},{account:"2220",debit:0,credit:100000}],law:"¬ß 5-1 (BOKL)"},
                {num:10,difficulty:"hard",description:"Eier skyter inn kr 50 000 i aksjekapital.",hint:"Bankinnskudd √∏ker, aksjekapital √∏ker.",solution:[{account:"1920",debit:50000,credit:0},{account:"2000",debit:0,credit:50000}],law:"Aksjeloven"},
                {num:11,difficulty:"hard",description:"Mottar renteinntekt fra bank kr 1 500.",hint:"Bankinnskudd √∏ker, renteinntekt krediteres.",solution:[{account:"1920",debit:1500,credit:0},{account:"8050",debit:0,credit:1500}],law:"¬ß 5-1 (BOKL)"},
                {num:12,difficulty:"hard",description:"Betaler renter p√• l√•n, kr 3 000.",hint:"Rentekostnad debiteres, bankinnskudd krediteres.",solution:[{account:"8150",debit:3000,credit:0},{account:"1920",debit:0,credit:3000}],law:"¬ß 5-1 (BOKL)"},
                {num:13,difficulty:"hard",description:"Beregner betalbar skatt p√• kr 45 000.",hint:"Skattekostnad debiteres, betalbar skatt (gjeld) krediteres.",solution:[{account:"8300",debit:45000,credit:0},{account:"2500",debit:0,credit:45000}],law:"Skatteloven"},
                {num:14,difficulty:"hard",description:"MVA-oppgj√∏r: Utg. mva kr 25 000, inng. mva kr 8 000. Skyldig = kr 17 000.",hint:"Utg. mva debiteres, inng. mva krediteres, differansen til oppgj√∏rskonto.",solution:[{account:"2700",debit:25000,credit:0},{account:"2710",debit:0,credit:8000},{account:"2740",debit:0,credit:17000}],law:"¬ß 11-1 (MVAL)"},
                {num:15,difficulty:"hard",description:"Betaler MVA-oppgj√∏ret p√• kr 17 000 til staten.",hint:"Oppgj√∏rskonto debiteres, bank krediteres.",solution:[{account:"2740",debit:17000,credit:0},{account:"1920",debit:0,credit:17000}],law:"¬ß 11-1 (MVAL)"},
                {num:16,difficulty:"hard",description:"MVA tilgode: Utg. mva kr 5 000, inng. mva kr 12 000. Tilgode kr 7 000.",hint:"Utg. mva debiteres, inng. mva krediteres, bank debiteres.",solution:[{account:"2700",debit:5000,credit:0},{account:"2710",debit:0,credit:12000},{account:"1920",debit:7000,credit:0}],law:"¬ß 11-1 (MVAL)"},
                {num:17,difficulty:"hard",description:"Avsetter feriepenger 12% av l√∏nn kr 480 000 = kr 57 600.",hint:"Feriepenger (kostnad) debiteres, p√•l√∏pt feriepenger (gjeld) krediteres.",solution:[{account:"5180",debit:57600,credit:0},{account:"2940",debit:0,credit:57600}],law:"Ferieloven"},
                {num:18,difficulty:"hard",description:"Beregner AGA p√• feriepenger: 57 600 √ó 14,1% = kr 8 122.",hint:"AGA p√• feriepenger debiteres, p√•l√∏pt AGA krediteres.",solution:[{account:"5410",debit:8122,credit:0},{account:"2780",debit:0,credit:8122}],law:"Folketrygdloven"},
                {num:19,difficulty:"hard",description:"Selger aksjer for kr 150 000 (kostpris 120 000). Gevinst kr 30 000.",hint:"Bank debiteres med salgspris, aksjer krediteres med kostpris, gevinst krediteres.",solution:[{account:"1920",debit:150000,credit:0},{account:"1810",debit:0,credit:120000},{account:"8080",debit:0,credit:30000}],law:"¬ß 5-1 (BOKL)"}
            ];
            
            prog.style.width = '50%';
            const batch = {};
            exercises.forEach(ex => batch['ex_' + ex.num] = {...ex, createdAt: Date.now()});
            await db.ref('bokforing').update(batch);
            prog.style.width = '100%';
            showMsg('seeder-message', `‚úÖ ${exercises.length} bokf√∏ringsoppgaver lastet opp!`, 'success');
            loadDashboard();
        }

        async function seedWiki() {
            const prog = document.getElementById('prog-wiki');
            prog.style.width = '10%';
            
            const articles = [
                {id:"bilag",title:"Bilag og dokumentasjon",category:"bokforing",lawRef:"¬ß 10 BOKL",summary:"Alle transaksjoner skal dokumenteres med bilag.",content:"Bilag er dokumentasjon som bekrefter en transaksjon. Det kan v√¶re fakturaer, kvitteringer, bankutskrifter, kontrakter osv. Bilagene skal oppbevares i 5 √•r etter regnskaps√•rets slutt."},
                {id:"oppbevaring",title:"Oppbevaringstid",category:"bokforing",lawRef:"¬ß 13 BOKL",summary:"Regnskapsmateriale skal oppbevares i 5 √•r.",content:"Prim√¶rdokumentasjon som bilag skal oppbevares i minst 5 √•r. √Örsregnskap og andre spesifikasjoner skal oppbevares i 10 √•r. Elektronisk oppbevaring er tillatt."},
                {id:"debet-kredit",title:"Debet og kredit",category:"bokforing",lawRef:"GRS",summary:"Debet = venstre side, Kredit = h√∏yre side.",content:"I dobbel bokf√∏ring har hver konto en debetside (venstre) og kreditside (h√∏yre). Eiendeler og kostnader √∏ker p√• debet. Gjeld, egenkapital og inntekter √∏ker p√• kredit. Sum debet skal alltid v√¶re lik sum kredit."},
                {id:"kontoplan",title:"Kontoplan NS 4102",category:"bokforing",lawRef:"¬ß 4-1 BOKL",summary:"Standard kontoplan for norske foretak.",content:"NS 4102 er den norske standarden for kontoplan. Klasse 1: Eiendeler. Klasse 2: Egenkapital og gjeld. Klasse 3: Inntekter. Klasse 4-7: Kostnader. Klasse 8: Finansposter og skatt."},
                {id:"mva-satser",title:"MVA-satser",category:"mva",lawRef:"¬ß 5-1 MVAL",summary:"Norge har 25%, 15% og 12% MVA.",content:"Alminnelig sats er 25%. Matvarer har 15%. Persontransport, kino, hotell har 12%. Eksport har 0% (fritatt med fradragsrett). Helse, finans og utdanning er unntatt (ingen MVA, ingen fradrag)."},
                {id:"mva-oppgjor",title:"MVA-oppgj√∏r",category:"mva",lawRef:"¬ß 11-1 MVAL",summary:"Differansen mellom utg√•ende og inng√•ende MVA.",content:"MVA-oppgj√∏r beregnes som utg√•ende MVA minus inng√•ende MVA. Hvis positiv betales til staten. Hvis negativ mottas fra staten. Oppgj√∏ret leveres annenhver m√•ned (6 terminer per √•r)."},
                {id:"arsregnskap",title:"√Örsregnskap",category:"regnskap",lawRef:"¬ß 3-1 RSKL",summary:"Alle regnskapspliktige skal avlegge √•rsregnskap.",content:"√Örsregnskapet best√•r av resultatregnskap, balanse, kontantstr√∏moppstilling (for store foretak) og noter. Det skal gi et rettvisende bilde av virksomhetens finansielle stilling."},
                {id:"balanselikningen",title:"Balanselikningen",category:"regnskap",lawRef:"GRS",summary:"Eiendeler = Egenkapital + Gjeld",content:"Balanselikningen er grunnlaget for dobbel bokf√∏ring. Alt selskapet eier (eiendeler) m√• v√¶re finansiert av enten eiere (egenkapital) eller l√•nt (gjeld). Denne likningen m√• alltid balansere."},
                {id:"periodisering",title:"Periodisering",category:"regnskap",lawRef:"¬ß 4-1 RSKL",summary:"Inntekter og kostnader henf√∏res til riktig periode.",content:"Periodisering sikrer at inntekter og kostnader regnskapsf√∏res i den perioden de tilh√∏rer, uavhengig av n√•r betaling skjer. Dette f√∏lger av sammenstillingsprinsippet."},
                {id:"avskrivning",title:"Avskrivning",category:"regnskap",lawRef:"¬ß 5-3 RSKL",summary:"Systematisk fordeling av kostnad over levetid.",content:"Avskrivning fordeler kostnaden for varige driftsmidler over forventet levetid. Metodene inkluderer line√¶r (like mye hvert √•r), saldo (fast prosent av restverdi) og produksjonsbasert."},
                {id:"selskapsskatt",title:"Selskapsskatt",category:"skatt",lawRef:"SKTL",summary:"Selskapsskattesatsen er 22%.",content:"Aksjeselskaper betaler 22% skatt p√• alminnelig inntekt. Skattemessig inntekt kan avvike fra regnskapsmessig resultat p√• grunn av midlertidige og permanente forskjeller."},
                {id:"utsatt-skatt",title:"Utsatt skatt",category:"skatt",lawRef:"¬ß 5-14 RSKL",summary:"Skatt p√• midlertidige forskjeller.",content:"Utsatt skatt oppst√•r n√•r det er midlertidige forskjeller mellom regnskapsmessig og skattemessig verdi. Forskjellene reverserer over tid, og utsatt skatt reflekterer fremtidig skatteeffekt."},
                {id:"likviditetsgrad",title:"Likviditetsgrad",category:"analyse",lawRef:"GRS",summary:"M√•ler evnen til √• betale kortsiktig gjeld.",content:"Likviditetsgrad 1 = Oml√∏psmidler / Kortsiktig gjeld. B√∏r v√¶re over 1,5. Likviditetsgrad 2 = (Oml√∏psmidler - Varelager) / Kortsiktig gjeld. B√∏r v√¶re over 1,0."},
                {id:"egenkapitalandel",title:"Egenkapitalandel",category:"analyse",lawRef:"GRS",summary:"Andel av totalkapitalen som er egenkapital.",content:"Egenkapitalandel = Egenkapital / Totalkapital. Viser hvor stor del av virksomheten som er finansiert av eierne. H√∏yere andel gir lavere finansiell risiko. B√∏r v√¶re minst 20-30%."},
                {id:"roe",title:"Egenkapitalrentabilitet (ROE)",category:"analyse",lawRef:"GRS",summary:"Avkastning p√• egenkapitalen.",content:"ROE = Resultat / Gjennomsnittlig egenkapital √ó 100. Viser hvor mye avkastning eierne f√•r p√• sin investerte kapital. B√∏r v√¶re h√∏yere enn risikofri rente pluss risikopremie."}
            ];
            
            prog.style.width = '50%';
            const batch = {};
            articles.forEach(a => batch[a.id] = {...a, createdAt: Date.now()});
            await db.ref('wiki').update(batch);
            prog.style.width = '100%';
            showMsg('seeder-message', `‚úÖ ${articles.length} wiki-artikler lastet opp!`, 'success');
            loadDashboard();
        }

        async function seedAll() {
            showMsg('seeder-message', 'üîÑ Laster opp alt innhold...', 'info');
            await seedQuiz();
            await seedBokforing();
            await seedWiki();
            showMsg('seeder-message', '‚úÖ Alt innhold lastet opp!', 'success');
        }

        // ============================================
        // EXCEL EXPORT
        // ============================================
        function exportQuiz() {
            if (!allData.quiz.length) { alert('Ingen data. Last inn Quiz-siden f√∏rst.'); return; }
            const ws = XLSX.utils.json_to_sheet(allData.quiz.map(q => ({
                Type: q.type,
                Kategori: q.category,
                Sp√∏rsm√•l: q.q,
                Alternativer: (q.opts || []).join(' | '),
                Svar: Array.isArray(q.a) ? q.a.join(',') : q.a,
                Lov: q.l,
                Forklaring: q.exp
            })));
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Quiz');
            XLSX.writeFile(wb, 'AccountingQuest_Quiz.xlsx');
        }

        function exportBokforing() {
            if (!allData.bokforing.length) { alert('Ingen data. Last inn Bokf√∏ring-siden f√∏rst.'); return; }
            const ws = XLSX.utils.json_to_sheet(allData.bokforing.map(b => ({
                Nr: b.num,
                Niv√•: b.difficulty,
                Beskrivelse: b.description,
                Hint: b.hint,
                Lov: b.law,
                L√∏sning: JSON.stringify(b.solution)
            })));
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Bokf√∏ring');
            XLSX.writeFile(wb, 'AccountingQuest_Bokforing.xlsx');
        }

        function exportWiki() {
            if (!allData.wiki.length) { alert('Ingen data. Last inn Wiki-siden f√∏rst.'); return; }
            const ws = XLSX.utils.json_to_sheet(allData.wiki.map(w => ({
                ID: w.id,
                Tittel: w.title,
                Kategori: w.category,
                Lov: w.lawRef,
                Sammendrag: w.summary,
                Innhold: w.content
            })));
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Wiki');
            XLSX.writeFile(wb, 'AccountingQuest_Wiki.xlsx');
        }

        function exportUsers() {
            if (!allData.users.length) { alert('Ingen data. Last inn Brukere-siden f√∏rst.'); return; }
            const ws = XLSX.utils.json_to_sheet(allData.users.map(u => ({
                Brukernavn: u.username || u.displayName,
                Epost: u.email,
                Rolle: u.role,
                Opprettet: u.createdAt ? new Date(u.createdAt).toLocaleDateString('no-NO') : ''
            })));
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Brukere');
            XLSX.writeFile(wb, 'AccountingQuest_Brukere.xlsx');
        }

        async function exportAll() {
            // Load all data first
            await loadQuiz();
            await loadBokforing();
            await loadWiki();
            await loadUsers();
            
            const wb = XLSX.utils.book_new();
            
            // Quiz
            const wsQuiz = XLSX.utils.json_to_sheet(allData.quiz.map(q => ({
                Type: q.type, Kategori: q.category, Sp√∏rsm√•l: q.q, Svar: q.a, Lov: q.l, Forklaring: q.exp
            })));
            XLSX.utils.book_append_sheet(wb, wsQuiz, 'Quiz');
            
            // Bokf√∏ring
            const wsBok = XLSX.utils.json_to_sheet(allData.bokforing.map(b => ({
                Nr: b.num, Niv√•: b.difficulty, Beskrivelse: b.description, Hint: b.hint, Lov: b.law
            })));
            XLSX.utils.book_append_sheet(wb, wsBok, 'Bokf√∏ring');
            
            // Wiki
            const wsWiki = XLSX.utils.json_to_sheet(allData.wiki.map(w => ({
                ID: w.id, Tittel: w.title, Kategori: w.category, Lov: w.lawRef, Sammendrag: w.summary
            })));
            XLSX.utils.book_append_sheet(wb, wsWiki, 'Wiki');
            
            // Brukere
            const wsUsers = XLSX.utils.json_to_sheet(allData.users.map(u => ({
                Brukernavn: u.username, Epost: u.email, Rolle: u.role
            })));
            XLSX.utils.book_append_sheet(wb, wsUsers, 'Brukere');
            
            XLSX.writeFile(wb, 'AccountingQuest_Alt.xlsx');
        }

        // ============================================
        // JSON IMPORT FUNCTIONS
        // ============================================
        let pendingJsonData = null;
        let detectedModule = null;

        function handleJsonFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    processJsonData(data, file.name);
                } catch (err) {
                    showMsg('seeder-message', '‚ùå Ugyldig JSON-fil: ' + err.message, 'error');
                    pendingJsonData = null;
                    document.getElementById('btn-import-json').disabled = true;
                }
            };
            reader.readAsText(file);
        }

        function processJsonData(data, filename) {
            const selectedModule = document.getElementById('import-module').value;
            let items = [];
            
            // Detect module from data structure
            if (data.metadata && data.metadata.module === 'corporate_finance') {
                detectedModule = 'corporate_finance';
                items = data.exercises || [];
            } else if (data.exercises && Array.isArray(data.exercises)) {
                detectedModule = data.metadata?.module || 'corporate_finance';
                items = data.exercises;
            } else if (data.quizQuestions) {
                detectedModule = 'quiz';
                items = Object.values(data.quizQuestions);
            } else if (Array.isArray(data)) {
                // Check first item to detect module
                const first = data[0];
                if (first && first.module === 'corporate_finance') {
                    detectedModule = 'corporate_finance';
                } else if (first && (first.topic || first.category)) {
                    detectedModule = first.module || 'quiz';
                }
                items = data;
            } else if (typeof data === 'object') {
                items = Object.values(data);
                detectedModule = items[0]?.module || 'quiz';
            }

            // Override with manual selection if not auto
            if (selectedModule !== 'auto') {
                detectedModule = selectedModule;
            }

            const count = items.length;
            
            if (count === 0) {
                showMsg('seeder-message', '‚ùå Ingen oppgaver funnet i filen', 'error');
                return;
            }

            pendingJsonData = items;
            
            // Update preview
            document.getElementById('json-preview-count').textContent = `${count} oppgaver funnet`;
            document.getElementById('json-detected-module').textContent = `Modul: ${getModuleName(detectedModule)}`;
            document.getElementById('btn-import-json').disabled = false;
            document.getElementById('json-preview').style.display = 'block';

            // Analyze topics/categories
            const topics = {};
            items.forEach(q => {
                const topic = q.topic || q.category || 'ukjent';
                topics[topic] = (topics[topic] || 0) + 1;
            });

            // Display categories
            const catContainer = document.getElementById('json-categories');
            catContainer.innerHTML = Object.entries(topics)
                .map(([topic, count]) => `<span class="badge badge-blue">${topic}: ${count}</span>`)
                .join('');

            // Display preview table
            const tbody = document.getElementById('json-preview-body');
            const previewItems = items.slice(0, 20);
            tbody.innerHTML = previewItems.map(q => `
                <tr>
                    <td>${q.id || '-'}</td>
                    <td>${(q.title || q.question || q.q || '').substring(0, 50)}...</td>
                    <td><span class="badge badge-blue">${q.topic || q.category || '-'}</span></td>
                    <td><span class="badge ${getDiffBadge(q.difficulty)}">${q.difficulty || '-'}</span></td>
                </tr>
            `).join('');

            if (count > 20) {
                tbody.innerHTML += `<tr><td colspan="4" style="text-align:center; color:#9ca3af;">... og ${count - 20} flere</td></tr>`;
            }

            showMsg('seeder-message', `‚úÖ Fil lastet: ${filename} (${count} oppgaver, modul: ${getModuleName(detectedModule)})`, 'success');
        }

        function getModuleName(module) {
            const names = {
                'corporate_finance': 'üíπ Corporate Finance',
                'quiz': '‚ùì Quiz',
                'bokforing': 'üìñ Bokf√∏ring',
                'wiki': 'üìö Wiki'
            };
            return names[module] || module;
        }

        function getDiffBadge(difficulty) {
            if (!difficulty) return 'badge-secondary';
            if (difficulty.includes('lett') || difficulty === 'easy') return 'badge-green';
            if (difficulty.includes('middels') || difficulty === 'medium') return 'badge-orange';
            if (difficulty.includes('vansk') || difficulty === 'hard') return 'badge-red';
            return 'badge-purple';
        }

        async function importJsonToFirebase() {
            if (!pendingJsonData || !detectedModule) {
                showMsg('seeder-message', '‚ùå Ingen data √• importere', 'error');
                return;
            }

            const count = pendingJsonData.length;
            
            if (!confirm(`Er du sikker p√• at du vil importere ${count} oppgaver til ${getModuleName(detectedModule)}?\n\nEksisterende oppgaver med samme ID vil bli overskrevet.`)) {
                return;
            }

            const prog = document.getElementById('prog-json-import');
            const btn = document.getElementById('btn-import-json');
            btn.disabled = true;
            btn.textContent = '‚è≥ Importerer...';

            try {
                prog.style.width = '10%';
                showMsg('seeder-message', 'üîÑ Importerer til Firebase...', 'info');

                let imported = 0;
                let errors = 0;

                if (detectedModule === 'corporate_finance') {
                    // Corporate Finance: write to questions/corporate_finance/{topic}/{difficulty}/{id}
                    // And solutions to solutions/corporate_finance/{id}
                    for (const ex of pendingJsonData) {
                        try {
                            const topic = ex.topic || 'general';
                            const difficulty = ex.difficulty || 'medium';
                            const id = ex.id || `cf_${Date.now()}_${imported}`;
                            
                            // Question data (without solution)
                            const questionPath = `questions/corporate_finance/${topic}/${difficulty}/${id}`;
                            const questionData = {
                                id: id,
                                module: 'corporate_finance',
                                topic: topic,
                                difficulty: difficulty,
                                type: ex.type || 'multiple_choice',
                                title: ex.title || '',
                                question: ex.question || ex.title || '',
                                tags: ex.tags || [],
                                source: ex.source || 'B√òK260'
                            };
                            
                            if (ex.type === 'multiple_choice' && ex.options) {
                                questionData.options = ex.options.map(o => ({ id: o.id, text: o.text }));
                            } else if (ex.type === 'calculation' && ex.data) {
                                questionData.data = ex.data;
                                questionData.formula = ex.formula || '';
                            }
                            
                            await db.ref(questionPath).set(questionData);
                            
                            // Solution data
                            const solutionPath = `solutions/corporate_finance/${id}`;
                            const solutionData = {
                                hints: ex.hints || [],
                                explanation: ex.explanation || ''
                            };
                            
                            if (ex.type === 'multiple_choice') {
                                solutionData.correct = ex.correct || (ex.options?.find(o => o.correct)?.id) || 'a';
                            } else {
                                solutionData.correct = ex.correct || ex.correctAnswer;
                                solutionData.tolerance = ex.tolerance || 0;
                            }
                            
                            await db.ref(solutionPath).set(solutionData);
                            imported++;
                            
                        } catch (e) {
                            console.error('Error importing:', ex.id, e);
                            errors++;
                        }
                        
                        prog.style.width = `${Math.round((imported / count) * 100)}%`;
                    }
                    
                    // Update metadata
                    await db.ref('questions/_metadata').update({
                        corporate_finance_count: imported,
                        lastUpdated: Date.now()
                    });
                    
                } else if (detectedModule === 'quiz') {
                    // Quiz: write to quizQuestions/{id}
                    const batchSize = 50;
                    for (let i = 0; i < pendingJsonData.length; i += batchSize) {
                        const batch = pendingJsonData.slice(i, i + batchSize);
                        const updates = {};
                        
                        batch.forEach((q, idx) => {
                            const id = q.id || `quiz_${Date.now()}_${i + idx}`;
                            if (!q.createdAt) q.createdAt = Date.now();
                            updates[id] = q;
                        });

                        await db.ref('quizQuestions').update(updates);
                        imported += batch.length;
                        prog.style.width = `${Math.round((imported / count) * 100)}%`;
                    }
                    
                } else if (detectedModule === 'bokforing') {
                    // Bokf√∏ring: write to bokforing/{id}
                    for (const ex of pendingJsonData) {
                        const id = ex.id || `bok_${Date.now()}_${imported}`;
                        await db.ref(`bokforing/${id}`).set(ex);
                        imported++;
                        prog.style.width = `${Math.round((imported / count) * 100)}%`;
                    }
                    
                } else if (detectedModule === 'wiki') {
                    // Wiki: write to wiki/articles/{id}
                    for (const article of pendingJsonData) {
                        const id = article.id || `wiki_${Date.now()}_${imported}`;
                        await db.ref(`wiki/articles/${id}`).set({
                            ...article,
                            createdAt: article.createdAt || Date.now(),
                            updatedAt: Date.now()
                        });
                        imported++;
                        prog.style.width = `${Math.round((imported / count) * 100)}%`;
                    }
                }

                prog.style.width = '100%';
                showMsg('seeder-message', `‚úÖ ${imported} oppgaver importert til ${getModuleName(detectedModule)}! ${errors > 0 ? `(${errors} feil)` : ''}`, 'success');
                
                // Reset
                pendingJsonData = null;
                detectedModule = null;
                document.getElementById('json-preview').style.display = 'none';
                document.getElementById('json-preview-count').textContent = 'Ingen fil valgt';
                document.getElementById('json-detected-module').textContent = '';
                document.getElementById('json-file-input').value = '';
                btn.textContent = '‚¨ÜÔ∏è Importer til Firebase';
                btn.disabled = true;

                // Reload dashboard stats
                loadDashboard();

            } catch (error) {
                console.error('Import error:', error);
                showMsg('seeder-message', '‚ùå Feil ved import: ' + error.message, 'error');
                btn.textContent = '‚¨ÜÔ∏è Importer til Firebase';
                btn.disabled = false;
            }
        }

        function downloadTemplate(module) {
            let template;
            
            if (module === 'corporate_finance') {
                template = {
                    metadata: {
                        module: "corporate_finance",
                        version: "1.0.0"
                    },
                    exercises: [
                        {
                            id: "cf_example_001",
                            topic: "npv",
                            difficulty: "easy",
                            type: "multiple_choice",
                            title: "Eksempel NPV sp√∏rsm√•l",
                            question: "Hva er NPV beslutningsregelen?",
                            options: [
                                { id: "a", text: "Aksepter hvis NPV > 0" },
                                { id: "b", text: "Aksepter hvis NPV > 100" }
                            ],
                            correct: "a",
                            explanation: "NPV > 0 betyr verdiskaping",
                            hints: ["Tenk p√• verdiskaping"],
                            tags: ["npv"],
                            source: "B√òK260"
                        },
                        {
                            id: "cf_example_002",
                            topic: "irr",
                            difficulty: "medium",
                            type: "calculation",
                            title: "Eksempel kalkulator",
                            question: "Beregn NPV...",
                            data: { investment: 100000, rate: 0.10 },
                            correct: 12345,
                            tolerance: 100,
                            formula: "NPV = -I + CF/(1+r)",
                            hints: ["Bruk formel"],
                            tags: ["npv", "calculation"],
                            source: "B√òK260"
                        }
                    ]
                };
            } else {
                template = {
                    quizQuestions: {
                        "quiz_example_001": {
                            id: "quiz_example_001",
                            category: "regnskap",
                            difficulty: "easy",
                            question: "Eksempel sp√∏rsm√•l?",
                            options: ["Svar A", "Svar B", "Svar C", "Svar D"],
                            correct: 0,
                            explanation: "Forklaring her"
                        }
                    }
                };
            }
            
            const blob = new Blob([JSON.stringify(template, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${module}-template.json`;
            a.click();
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
