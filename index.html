<!DOCTYPE html>
<html lang="no" data-theme="dark" data-accent="green">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <title>AccountingQuest - L√¶r Norsk Bokf√∏ring og Regnskap</title>
    <meta name="description" content="Gamifisert l√¶ringsplattform for norsk bokf√∏ring, regnskap og corporate finance. Interaktive oppgaver basert p√• norsk lovverk.">
    <meta name="author" content="AccountingQuest">
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìö</text></svg>">
    <meta name="theme-color" content="#0f1419">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <link rel="stylesheet" href="css/main.css">
    
    <style>
        /* Page-specific overrides only - main.css handles the rest */
        
        /* Welcome Hero */
        .welcome-hero {
            text-align: center;
            padding: 50px 30px;
            background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-secondary) 100%);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-xl);
            margin-bottom: 40px;
        }

        .welcome-hero h2 {
            font-size: 2.2em;
            margin-bottom: 15px;
            background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .welcome-hero p {
            color: var(--text-secondary);
            font-size: 1.1em;
            max-width: 600px;
            margin: 0 auto 25px;
        }

        .hero-stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            flex-wrap: wrap;
        }

        .hero-stat {
            text-align: center;
        }

        .hero-stat-value {
            font-size: 2em;
            font-weight: 700;
            color: var(--accent);
        }

        .hero-stat-label {
            font-size: 0.85em;
            color: var(--text-secondary);
        }

        /* Section headers */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-header h3 {
            font-size: 1.4em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Module Cards Grid */
        .modules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .module-card {
            background: var(--bg-card);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .module-card:hover {
            border-color: var(--accent);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(74, 222, 128, 0.15);
        }

        .module-card-header {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            margin-bottom: 15px;
        }

        .module-icon {
            font-size: 2.5em;
            background: var(--bg-tertiary);
            padding: 12px;
            border-radius: var(--radius-md);
        }

        .module-info { flex: 1; }

        .module-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 4px 12px;
            border-radius: var(--radius-full);
            font-size: 0.75em;
            font-weight: 700;
        }

        .badge-popular {
            background: rgba(74, 222, 128, 0.2);
            color: var(--accent);
        }

        .badge-new {
            background: rgba(249, 115, 22, 0.2);
            color: #f97316;
        }

        .badge-live {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .badge-premium {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
        }

        .module-title {
            font-size: 1.3em;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .module-description {
            color: var(--text-secondary);
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        .module-meta {
            display: flex;
            gap: 15px;
            font-size: 0.85em;
            color: var(--text-muted);
        }

        .module-progress {
            margin-top: 15px;
        }

        .progress-bar {
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-full);
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--accent-secondary));
            border-radius: var(--radius-full);
            transition: width 0.5s ease;
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 40px;
        }

        .action-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .action-card:hover {
            border-color: var(--accent);
            background: var(--bg-tertiary);
        }

        .action-icon {
            font-size: 2em;
            background: var(--bg-tertiary);
            padding: 10px;
            border-radius: var(--radius-sm);
        }

        .action-info h4 {
            font-weight: 600;
            margin-bottom: 3px;
        }

        .action-info p {
            font-size: 0.85em;
            color: var(--text-secondary);
        }

        /* Progress Overview */
        .progress-overview {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 25px;
            margin-bottom: 40px;
        }

        .progress-overview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .progress-overview-header h3 {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .total-progress {
            font-size: 1.2em;
            color: var(--accent);
            font-weight: 700;
        }

        .progress-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .progress-item label {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            margin-bottom: 8px;
            color: var(--text-secondary);
        }

        .progress-item label span:last-child {
            color: var(--text-primary);
            font-weight: 600;
        }

        /* Teacher/Admin Sections */
        .special-section {
            margin-bottom: 40px;
            display: none;
        }

        .special-section.show { display: block; }

        .special-section h3 {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .special-section.teacher h3 { color: #a855f7; }
        .special-section.admin h3 { color: #f97316; }

        .special-section .action-card.teacher {
            border-color: rgba(168, 85, 247, 0.3);
        }

        .special-section .action-card.teacher:hover {
            border-color: #a855f7;
            background: rgba(168, 85, 247, 0.1);
        }

        .special-section .action-card.admin {
            border-color: rgba(249, 115, 22, 0.3);
        }

        .special-section .action-card.admin:hover {
            border-color: #f97316;
            background: rgba(249, 115, 22, 0.1);
        }

        /* User Badge in Header */
        .user-badge {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 14px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid var(--border-color);
        }

        .user-badge:hover {
            border-color: var(--accent);
        }

        .user-badge.teacher {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(99, 102, 241, 0.2));
            border-color: #8b5cf6;
        }

        .user-badge.admin {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(249, 115, 22, 0.2));
            border-color: #ef4444;
        }

        .user-icon { font-size: 1.3em; }

        .user-info-text {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            font-size: 0.9em;
        }

        .user-role {
            font-size: 0.75em;
            color: var(--accent);
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 30px 20px;
            border-top: 1px solid var(--border-color);
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
        }

        .footer-links a {
            color: var(--text-muted);
            transition: color 0.3s;
        }

        .footer-links a:hover {
            color: var(--accent);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .welcome-hero h2 { font-size: 1.6em; }
            .hero-stats { gap: 25px; }
            .modules-grid { grid-template-columns: 1fr; }
            .quick-actions { grid-template-columns: 1fr 1fr; }
            
            .aq-header-right {
                width: 100%;
                justify-content: flex-end;
            }
        }

        @media (max-width: 480px) {
            .quick-actions { grid-template-columns: 1fr; }
            .user-info-text { display: none; }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="aq-header">
        <div class="aq-header-left">
            <a href="index.html" class="aq-logo">
                <span class="aq-logo-icon">üìö</span>
                <span class="aq-logo-text">AccountingQuest</span>
            </a>
        </div>
        <div class="aq-header-right">
            <a href="wiki.html" class="aq-btn aq-btn-secondary">üìñ Wiki</a>
            <a href="settings.html" class="aq-btn aq-btn-icon" title="Innstillinger">‚öôÔ∏è</a>
            
            <!-- Logged out state -->
            <div id="logged-out-actions">
                <a href="auth.html" class="aq-btn aq-btn-primary">Logg inn</a>
            </div>
            
            <!-- Logged in state -->
            <div id="logged-in-actions" style="display: none;">
                <div class="user-badge" id="user-badge" onclick="handleUserClick()">
                    <span class="user-icon" id="user-icon">üë§</span>
                    <div class="user-info-text">
                        <span class="user-name" id="user-display-name">Bruker</span>
                        <span class="user-role" id="user-role-display">Student</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="aq-container">
        <!-- Welcome Hero -->
        <section class="welcome-hero">
            <h2 id="welcome-title">üéì Velkommen til AccountingQuest!</h2>
            <p id="welcome-text">L√¶r norsk bokf√∏ring, regnskap og finans gjennom interaktive √∏velser og spill.</p>
            <div class="hero-stats">
                <div class="hero-stat">
                    <div class="hero-stat-value">200+</div>
                    <div class="hero-stat-label">Oppgaver</div>
                </div>
                <div class="hero-stat">
                    <div class="hero-stat-value">6</div>
                    <div class="hero-stat-label">Moduler</div>
                </div>
                <div class="hero-stat">
                    <div class="hero-stat-value" id="completed-stat">0</div>
                    <div class="hero-stat-label">Fullf√∏rt</div>
                </div>
            </div>
        </section>

        <!-- Main Modules -->
        <section>
            <div class="section-header">
                <h3>üìö L√¶ringsmoduler</h3>
            </div>
            
            <div class="modules-grid">
                <!-- Bokf√∏ringsspill -->
                <article class="module-card" onclick="navigateTo('bokforingsspill_excel.html')">
                    <span class="module-badge badge-popular">Popul√¶r</span>
                    <div class="module-card-header">
                        <div class="module-icon">üìä</div>
                        <div class="module-info">
                            <h4 class="module-title">Bokf√∏ringsspill</h4>
                            <p class="module-description">Excel-lignende grids med drag-and-drop bokf√∏ring</p>
                        </div>
                    </div>
                    <div class="module-meta">
                        <span>üìù 36+ oppgaver</span>
                        <span>‚è±Ô∏è ~45 min</span>
                    </div>
                    <div class="module-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="bokforing-bar" style="width: 0%"></div>
                        </div>
                    </div>
                </article>

                <!-- Quiz -->
                <article class="module-card" onclick="navigateTo('quiz_updated.html')">
                    <div class="module-card-header">
                        <div class="module-icon">‚ùì</div>
                        <div class="module-info">
                            <h4 class="module-title">Quiz</h4>
                            <p class="module-description">Test kunnskapen din med flervalgsoppgaver</p>
                        </div>
                    </div>
                    <div class="module-meta">
                        <span>‚ùì 90+ sp√∏rsm√•l</span>
                        <span>üìö 10 kategorier</span>
                    </div>
                    <div class="module-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="quiz-bar" style="width: 0%"></div>
                        </div>
                    </div>
                </article>

                <!-- Regnskapsanalyse -->
                <article class="module-card" onclick="navigateTo('regnskapsanalyse.html')">
                    <div class="module-card-header">
                        <div class="module-icon">üìà</div>
                        <div class="module-info">
                            <h4 class="module-title">Regnskapsanalyse</h4>
                            <p class="module-description">Analyser n√∏kkeltall og finansielle data</p>
                        </div>
                    </div>
                    <div class="module-meta">
                        <span>üìä 11 analyser</span>
                        <span>üî¢ N√∏kkeltall</span>
                    </div>
                    <div class="module-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="analyse-bar" style="width: 0%"></div>
                        </div>
                    </div>
                </article>

                <!-- Case Studies -->
                <article class="module-card" onclick="navigateTo('case_studies_fixed.html')">
                    <span class="module-badge badge-premium">Premium</span>
                    <div class="module-card-header">
                        <div class="module-icon">üìã</div>
                        <div class="module-info">
                            <h4 class="module-title">Case Studies</h4>
                            <p class="module-description">Realistiske bedriftscenarioer</p>
                        </div>
                    </div>
                    <div class="module-meta">
                        <span>üè¢ 15 cases</span>
                        <span>üíº Praktisk</span>
                    </div>
                    <div class="module-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="case-bar" style="width: 0%"></div>
                        </div>
                    </div>
                </article>

                <!-- Hjernetrim -->
                <article class="module-card" onclick="navigateTo('hjernetrim.html')">
                    <span class="module-badge badge-new">Utfordring</span>
                    <div class="module-card-header">
                        <div class="module-icon">üß†</div>
                        <div class="module-info">
                            <h4 class="module-title">Hjernetrim</h4>
                            <p class="module-description">Ekstra vanskelige oppgaver for de dyktige</p>
                        </div>
                    </div>
                    <div class="module-meta">
                        <span>üî• Master-level</span>
                        <span>üèÜ Ekstra poeng</span>
                    </div>
                    <div class="module-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="hjernetrim-bar" style="width: 0%"></div>
                        </div>
                    </div>
                </article>

                <!-- Multiplayer -->
                <article class="module-card" onclick="navigateTo('multiplayer_index.html')">
                    <span class="module-badge badge-live">Live!</span>
                    <div class="module-card-header">
                        <div class="module-icon">üéÆ</div>
                        <div class="module-info">
                            <h4 class="module-title">Multiplayer</h4>
                            <p class="module-description">Kahoot-stil quiz og 1v1 dueller</p>
                        </div>
                    </div>
                    <div class="module-meta">
                        <span>üë• Sanntid</span>
                        <span>üèÜ Leaderboard</span>
                    </div>
                    <div class="module-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="multiplayer-bar" style="width: 0%"></div>
                        </div>
                    </div>
                </article>
            </div>
        </section>

        <!-- Quick Actions -->
        <section>
            <div class="section-header">
                <h3>‚ö° Hurtigvalg</h3>
            </div>
            
            <div class="quick-actions">
                <div class="action-card" onclick="navigateTo('multiplayer_index.html')">
                    <div class="action-icon">üë•</div>
                    <div class="action-info">
                        <h4>Multiplayer</h4>
                        <p>Spill mot andre</p>
                    </div>
                </div>
                <div class="action-card" onclick="navigateTo('duel.html')">
                    <div class="action-icon">‚öîÔ∏è</div>
                    <div class="action-info">
                        <h4>Duell</h4>
                        <p>1v1 quiz-kamp</p>
                    </div>
                </div>
                <div class="action-card" onclick="navigateTo('wiki.html')">
                    <div class="action-icon">üìñ</div>
                    <div class="action-info">
                        <h4>Wiki</h4>
                        <p>Lovverk og teori</p>
                    </div>
                </div>
                <div class="action-card" onclick="navigateTo('upgrade.html')">
                    <div class="action-icon">‚≠ê</div>
                    <div class="action-info">
                        <h4>Oppgrader</h4>
                        <p>F√• full tilgang</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Progress Overview -->
        <section class="progress-overview">
            <div class="progress-overview-header">
                <h3>üìä Din fremgang</h3>
                <span class="total-progress">Totalt: <span id="total-progress">0%</span></span>
            </div>
            <div class="progress-items">
                <div class="progress-item">
                    <label>
                        <span>Bokf√∏ring</span>
                        <span id="bokforing-pct">0%</span>
                    </label>
                    <div class="progress-bar">
                        <div class="progress-fill" id="bokforing-progress" style="width: 0%"></div>
                    </div>
                </div>
                <div class="progress-item">
                    <label>
                        <span>Quiz</span>
                        <span id="quiz-pct">0%</span>
                    </label>
                    <div class="progress-bar">
                        <div class="progress-fill" id="quiz-progress" style="width: 0%"></div>
                    </div>
                </div>
                <div class="progress-item">
                    <label>
                        <span>Analyse</span>
                        <span id="analyse-pct">0%</span>
                    </label>
                    <div class="progress-bar">
                        <div class="progress-fill" id="analyse-progress" style="width: 0%"></div>
                    </div>
                </div>
                <div class="progress-item">
                    <label>
                        <span>Case Studies</span>
                        <span id="case-pct">0%</span>
                    </label>
                    <div class="progress-bar">
                        <div class="progress-fill" id="case-progress" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Teacher Section (hidden by default) -->
        <section class="special-section teacher" id="teacher-section">
            <h3>üë®‚Äçüè´ L√¶rerverkt√∏y</h3>
            <div class="quick-actions">
                <div class="action-card teacher" onclick="navigateTo('teacher_portal.html')">
                    <div class="action-icon">üéì</div>
                    <div class="action-info">
                        <h4>L√¶rerportal</h4>
                        <p>Administrer klasserom</p>
                    </div>
                </div>
                <div class="action-card teacher" onclick="navigateTo('game_host.html')">
                    <div class="action-icon">üéØ</div>
                    <div class="action-info">
                        <h4>Start Quiz</h4>
                        <p>Kahoot-stil klassespill</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Admin Section (hidden by default) -->
        <section class="special-section admin" id="admin-section">
            <h3>üîß Admin</h3>
            <div class="quick-actions">
                <div class="action-card admin" onclick="navigateTo('admin-dashboard.html')">
                    <div class="action-icon">‚öôÔ∏è</div>
                    <div class="action-info">
                        <h4>Admin Dashboard</h4>
                        <p>Administrer innhold</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <p>¬© 2024-2025 AccountingQuest - Norsk regnskaps- og finansl√¶ring</p>
        <nav class="footer-links">
            <a href="wiki.html">Wiki</a>
            <a href="settings.html">Innstillinger</a>
            <a href="upgrade.html">Priser</a>
            <a href="#" onclick="showAbout(); return false;">Om oss</a>
        </nav>
    </footer>

    <script>
        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyBPnvICblMUOVXkNSwba7NUqDALNa3lEUg",
            authDomain: "accountingquest.firebaseapp.com",
            databaseURL: "https://accountingquest-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "accountingquest",
            storageBucket: "accountingquest.firebasestorage.app",
            messagingSenderId: "495735037392",
            appId: "1:495735037392:web:ff1dc9d8f498c6926fed2a"
        };
        
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        let currentUser = null;

        // Navigation
        function navigateTo(page) {
            window.location.href = page;
        }

        // Role labels
        const ROLE_LABELS = {
            'free': 'Gratis',
            'student': 'Student',
            'pro': 'Pro',
            'student_pro': 'Student Pro',
            'teacher_lite': 'L√¶rer Lite',
            'teacher': 'L√¶rer',
            'teacher_pro': 'L√¶rer Pro',
            'admin': 'Admin'
        };

        // Auth state listener
        auth.onAuthStateChanged(async (user) => {
            currentUser = user;
            
            if (user && !user.isAnonymous) {
                // Logged in
                document.getElementById('logged-out-actions').style.display = 'none';
                document.getElementById('logged-in-actions').style.display = 'block';
                
                try {
                    const snap = await db.ref('users/' + user.uid).once('value');
                    const userData = snap.val() || {};
                    
                    // Set display name
                    const displayName = userData.username || user.displayName || user.email?.split('@')[0] || 'Bruker';
                    document.getElementById('user-display-name').textContent = displayName;
                    
                    // Set role
                    const role = userData.role || 'free';
                    document.getElementById('user-role-display').textContent = ROLE_LABELS[role] || 'Student';
                    
                    // Update user badge style
                    const userBadge = document.getElementById('user-badge');
                    const userIcon = document.getElementById('user-icon');
                    
                    if (role === 'admin') {
                        userBadge.classList.add('admin');
                        userIcon.textContent = 'üõ°Ô∏è';
                        document.getElementById('admin-section').classList.add('show');
                        document.getElementById('teacher-section').classList.add('show');
                    } else if (role.includes('teacher')) {
                        userBadge.classList.add('teacher');
                        userIcon.textContent = 'üë®‚Äçüè´';
                        document.getElementById('teacher-section').classList.add('show');
                    } else if (role === 'pro' || role === 'student_pro') {
                        userIcon.textContent = '‚≠ê';
                    } else {
                        userIcon.textContent = 'üéì';
                    }
                    
                } catch (e) {
                    console.error('Error loading user data:', e);
                    document.getElementById('user-display-name').textContent = user.email?.split('@')[0] || 'Bruker';
                }
                
            } else {
                // Not logged in
                document.getElementById('logged-out-actions').style.display = 'block';
                document.getElementById('logged-in-actions').style.display = 'none';
            }
            
            // Load progress
            loadProgress();
        });

        // Load progress from localStorage
        function loadProgress() {
            let totalCompleted = 0;
            let totalPossible = 0;
            
            // Bokf√∏ring progress
            try {
                const bk = JSON.parse(localStorage.getItem('bokforingsspill_progress') || '{}');
                const bkCompleted = (bk.completedLessons || []).length;
                const bkTotal = 36;
                const bkPct = Math.round((bkCompleted / bkTotal) * 100);
                
                document.getElementById('bokforing-bar').style.width = bkPct + '%';
                document.getElementById('bokforing-progress').style.width = bkPct + '%';
                document.getElementById('bokforing-pct').textContent = bkPct + '%';
                
                totalCompleted += bkCompleted;
                totalPossible += bkTotal;
            } catch(e) {}
            
            // Quiz progress
            try {
                const qz = JSON.parse(localStorage.getItem('quiz_v2') || '{}');
                let qzCompleted = 0;
                if (qz.answeredQuestions) {
                    Object.values(qz.answeredQuestions).forEach(cat => {
                        qzCompleted += Object.keys(cat).length;
                    });
                }
                const qzTotal = 90;
                const qzPct = Math.round((qzCompleted / qzTotal) * 100);
                
                document.getElementById('quiz-bar').style.width = qzPct + '%';
                document.getElementById('quiz-progress').style.width = qzPct + '%';
                document.getElementById('quiz-pct').textContent = qzPct + '%';
                
                totalCompleted += qzCompleted;
                totalPossible += qzTotal;
            } catch(e) {}
            
            // Analyse progress
            try {
                const an = JSON.parse(localStorage.getItem('analyseProgress') || '{}');
                const anCompleted = Object.keys(an).filter(k => an[k]).length;
                const anTotal = 11;
                const anPct = Math.round((anCompleted / anTotal) * 100);
                
                document.getElementById('analyse-bar').style.width = anPct + '%';
                document.getElementById('analyse-progress').style.width = anPct + '%';
                document.getElementById('analyse-pct').textContent = anPct + '%';
                
                totalCompleted += anCompleted;
                totalPossible += anTotal;
            } catch(e) {}
            
            // Case progress
            try {
                const cs = JSON.parse(localStorage.getItem('caseProgress') || '{}');
                const csCompleted = Object.keys(cs).filter(k => cs[k]).length;
                const csTotal = 15;
                const csPct = Math.round((csCompleted / csTotal) * 100);
                
                document.getElementById('case-bar').style.width = csPct + '%';
                document.getElementById('case-progress').style.width = csPct + '%';
                document.getElementById('case-pct').textContent = csPct + '%';
                
                totalCompleted += csCompleted;
                totalPossible += csTotal;
            } catch(e) {}
            
            // Total progress
            const totalPct = totalPossible > 0 ? Math.round((totalCompleted / totalPossible) * 100) : 0;
            document.getElementById('total-progress').textContent = totalPct + '%';
            document.getElementById('completed-stat').textContent = totalCompleted;
        }

        // Handle user badge click
        function handleUserClick() {
            if (currentUser && !currentUser.isAnonymous) {
                window.location.href = 'settings.html';
            } else {
                window.location.href = 'auth.html';
            }
        }

        // Show about
        function showAbout() {
            alert('AccountingQuest v2.1\n\nEn gamifisert l√¶ringsplattform for norsk regnskap.\n\nDekker:\n‚Ä¢ Bokf√∏ringsloven\n‚Ä¢ Regnskapsloven\n‚Ä¢ Skatteloven\n‚Ä¢ MVA-loven\n‚Ä¢ Regnskapsanalyse\n‚Ä¢ Corporate Finance');
        }
    </script>
    
    <script src="js/theme-manager.js"></script>
    <script>if (typeof ThemeManager !== 'undefined') ThemeManager.init();</script>
</body>
</html>
