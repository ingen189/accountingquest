<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case Studies - Avansert Regnskap</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìã</text></svg>">
    <meta name="theme-color" content="#0f1419">

        
    <!-- External CSS -->
    <link rel="stylesheet" href="css/main.css">
    
    <style>
        /* ===== PAGE SPECIFIC STYLES ===== */

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Header */
        .game-header {
            background: var(--bg-secondary);
            border-bottom: 2px solid var(--bg-tertiary);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .back-btn {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .back-btn:hover {
            background: var(--accent);
            color: var(--bg-primary);
        }

        .header-stats {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .stat-item {
            background: var(--bg-tertiary);
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 0.95em;
        }

        .stat-label {
            color: var(--text-secondary);
            margin-right: 5px;
        }

        .stat-value {
            color: var(--accent);
            font-weight: bold;
        }

        /* Main Content */
        .game-content {
            display: flex;
            min-height: calc(100vh - 100px);
        }

        /* Sidebar */
        .sidebar {
            width: 320px;
            background: var(--bg-secondary);
            border-right: 2px solid var(--bg-tertiary);
            overflow-y: auto;
            padding: 20px;
        }

        .sidebar h3 {
            color: var(--accent);
            margin-bottom: 15px;
            font-size: 1.2em;
            border-bottom: 2px solid var(--bg-tertiary);
            padding-bottom: 10px;
        }

        .task-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .task-item {
            background: var(--bg-tertiary);
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 3px solid transparent;
        }

        .task-item:hover {
            background: #4a4a4a;
            border-left-color: var(--accent);
        }

        .task-item.active {
            background: rgba(74, 222, 128, 0.2);
            border-left-color: var(--accent);
        }

        .task-item.completed {
            border-left-color: var(--accent-hover);
        }

        .task-item-title {
            font-weight: bold;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .task-item-category {
            font-size: 0.85em;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .task-item-difficulty {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.75em;
            font-weight: bold;
        }

        .difficulty-easy { background: rgba(74, 222, 128, 0.2); color: var(--accent); }
        .difficulty-medium { background: rgba(245, 158, 11, 0.2); color: var(--warning); }
        .difficulty-hard { background: rgba(239, 68, 68, 0.2); color: var(--error); }

        .status-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 10px;
            font-weight: bold;
            font-size: 0.75em;
            margin-top: 8px;
            margin-left: 8px;
        }

        .status-badge.completed {
            background: rgba(34, 197, 94, 0.2);
            color: var(--accent-hover);
        }

        .status-badge.not-started {
            background: rgba(107, 114, 128, 0.2);
            color: var(--text-secondary);
        }

        /* Workspace */
        .workspace {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .progress-container {
            background: var(--bg-secondary);
            border: 2px solid var(--bg-tertiary);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .progress-bar-wrapper {
            width: 100%;
            height: 30px;
            background: var(--bg-primary);
            border-radius: 15px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--accent-hover));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            transition: width 0.5s;
        }

        .task-header {
            background: var(--bg-secondary);
            border: 2px solid var(--bg-tertiary);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .task-title {
            font-size: 1.8em;
            color: var(--accent);
            margin-bottom: 15px;
        }

        .task-description {
            background: var(--bg-tertiary);
            padding: 20px;
            border-radius: 8px;
            line-height: 1.8;
            border-left: 4px solid var(--accent);
        }

        .task-description h4 {
            color: var(--accent);
            margin-top: 15px;
            margin-bottom: 10px;
        }

        .task-description p {
            color: var(--text-primary);
            margin-bottom: 10px;
        }

        .task-description ul {
            margin-left: 20px;
            margin-top: 10px;
            color: var(--text-primary);
        }

        .task-description li {
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .task-description strong {
            color: var(--accent);
        }

        .task-description code {
            background: var(--bg-primary);
            padding: 2px 6px;
            border-radius: 3px;
            color: var(--info);
            font-family: 'Consolas', monospace;
        }

        /* Excel Grid */
        .excel-grid {
            background: var(--bg-secondary);
            border: 2px solid var(--bg-tertiary);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .grid-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .grid-btn {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .grid-btn:hover {
            background: var(--accent);
            color: var(--bg-primary);
        }

        .spreadsheet {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-primary);
            overflow-x: auto;
        }

        .spreadsheet th {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            padding: 10px;
            font-weight: bold;
            border: 1px solid #555;
            text-align: center;
            font-size: 0.9em;
        }

        .spreadsheet td {
            border: 1px solid #555;
            padding: 0;
            position: relative;
        }

        .cell {
            width: 100%;
            height: 100%;
            background: transparent;
            border: none;
            color: var(--text-primary);
            padding: 10px;
            font-size: 0.95em;
            font-family: 'Consolas', 'Courier New', monospace;
            text-align: right;
        }

        .cell:focus {
            outline: 2px solid var(--accent);
            background: var(--bg-secondary);
            z-index: 5;
        }

        .cell.readonly {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            cursor: not-allowed;
        }

        .cell.text-cell {
            text-align: left;
            font-weight: 600;
        }

        .cell-label {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            padding: 10px;
            text-align: center;
            font-weight: bold;
            border: 1px solid #555;
        }

        .cell.correct {
            background: rgba(74, 222, 128, 0.2) !important;
        }

        .cell.incorrect {
            background: rgba(239, 68, 68, 0.2) !important;
        }

        .cell.formula {
            color: var(--info);
        }

        /* Remove spinner from number inputs */
        .cell[type="number"]::-webkit-outer-spin-button,
        .cell[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .cell[type="number"] {
            -moz-appearance: textfield;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .action-btn {
            padding: 15px 40px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .action-btn.check {
            background: var(--accent);
            color: var(--bg-primary);
        }

        .action-btn.check:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
        }

        .action-btn.hint {
            background: var(--warning);
            color: white;
        }

        .action-btn.hint:hover {
            background: var(--warning);
        }

        .action-btn.reset {
            background: var(--error);
            color: white;
        }

        .action-btn.reset:hover {
            background: #dc2626;
        }

        .action-btn.next {
            background: var(--info);
            color: white;
        }

        .action-btn.next:hover {
            background: #2563eb;
        }

        /* Feedback */
        .feedback {
            background: var(--bg-secondary);
            border: 2px solid var(--bg-tertiary);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
            display: none;
        }

        .feedback.show {
            display: block;
        }

        .feedback.correct {
            border-color: var(--accent);
            color: var(--accent);
            background: rgba(74, 222, 128, 0.1);
        }

        .feedback.incorrect {
            border-color: var(--error);
            color: var(--error);
            background: rgba(239, 68, 68, 0.1);
        }

        .hint-box {
            background: var(--bg-secondary);
            border: 2px solid var(--warning);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            display: none;
        }

        .hint-box.show {
            display: block;
        }

        .hint-title {
            color: var(--warning);
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .hint-box p {
            color: var(--text-primary);
            margin-bottom: 10px;
        }

        .hint-box ul {
            color: var(--text-primary);
            margin-left: 20px;
        }

        .hint-box li {
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .hint-box strong {
            color: var(--accent);
        }

        .hint-box code {
            background: var(--bg-primary);
            padding: 2px 6px;
            border-radius: 3px;
            color: var(--info);
            font-family: 'Consolas', monospace;
        }

        .explanation-box {
            background: var(--bg-secondary);
            border: 2px solid var(--info);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            display: none;
        }

        .explanation-box.show {
            display: block;
        }

        .explanation-title {
            color: var(--info);
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .explanation-box p {
            color: var(--text-primary);
            margin-bottom: 10px;
        }

        .explanation-box ul {
            color: var(--text-primary);
            margin-left: 20px;
        }

        .explanation-box li {
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .explanation-box strong {
            color: var(--accent);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .game-content {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                max-height: 300px;
            }

            .workspace {
                padding: 15px;
            }

            .action-buttons {
                flex-direction: column;
            }

            .action-btn {
                width: 100%;
            }
        }
    
    </style>

</head>
<body>
    <!-- Header -->
    <div class="game-header">
        <div class="header-left">
            <button class="back-btn" onclick="backToMenu()">‚Üê Tilbake</button>
            <div class="stat-item">
                <span class="stat-label">Modul:</span>
                <span class="stat-value">Case Studies</span>
            </div>
        </div>
        
        <div class="header-stats">
            <div class="stat-item">
                <span class="stat-label">Oppgave:</span>
                <span class="stat-value"><span id="current-task">1</span>/<span id="total-tasks">15</span></span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Fullf√∏rt:</span>
                <span class="stat-value" id="completed-count">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Poeng:</span>
                <span class="stat-value" id="score">0</span>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="game-content">
        <!-- Sidebar -->
        <div class="sidebar">
            <h3>üíº Case-oppgaver</h3>
            <div class="task-list" id="task-list"></div>
        </div>

        <!-- Workspace -->
        <div class="workspace">
            <!-- Progress -->
            <div class="progress-container">
                <div class="progress-bar-wrapper">
                    <div class="progress-bar-fill" id="progress-fill" style="width: 0%">0%</div>
                </div>
            </div>

            <!-- Task Content -->
            <div id="task-content"></div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="action-btn hint" onclick="showHint()">üí° Hint</button>
                <button class="action-btn check" onclick="checkAnswer()">‚úì Sjekk svar</button>
                <button class="action-btn reset" onclick="resetTask()">üîÑ Nullstill</button>
                <button class="action-btn next" id="next-btn" onclick="nextTask()" style="display: none;">Neste ‚Üí</button>
            </div>

            <!-- Hint Box -->
            <div class="hint-box" id="hint-box">
                <div class="hint-title">üí° Hint:</div>
                <div id="hint-content"></div>
            </div>

            <!-- Explanation Box -->
            <div class="explanation-box" id="explanation-box">
                <div class="explanation-title">üìñ Forklaring:</div>
                <div id="explanation-content"></div>
            </div>

            <!-- Feedback -->
            <div class="feedback" id="feedback"></div>
        </div>
    </div>

    <script>
        // Task definitions - 15 comprehensive case studies
        const tasks = [
            {
                id: 1,
                title: "Case 1: Resultatdisponering - Grunnleggende",
                category: "√Örsavslutning",
                difficulty: "easy",
                description: `
                    <h4>Alpha Trading AS - Resultatdisponering for 20x5</h4>
                    <p><strong>Situasjon:</strong></p>
                    <p>Selskapet har gjort opp √•rsregnskapet for 20x5 og m√• n√• disponere √•rets resultat.</p>
                    <ul>
                        <li>√Örsresultat (overskudd): kr 800 000</li>
                        <li>Styret foresl√•r utbytte: kr 300 000</li>
                        <li>Resten skal overf√∏res til annen egenkapital</li>
                    </ul>
                    <p><strong>Oppgave:</strong> Fyll inn disponeringen i tabellen under.</p>
                `,
                hint: `
                    <p><strong>Resultatdisponering f√∏lger denne strukturen:</strong></p>
                    <ul>
                        <li>Utbytte bokf√∏res p√• konto 8920 (Avsatt utbytte)</li>
                        <li>Rest til annen egenkapital bokf√∏res p√• konto 8960</li>
                        <li>Total disponering m√• v√¶re lik √•rsresultatet (kr 800 000)</li>
                    </ul>
                    <p><code>Overf√∏ring til annen EK = 800 000 - 300 000 = 500 000</code></p>
                `,
                explanation: `
                    <p><strong>Resultatdisponering forklart:</strong></p>
                    <p>Etter at √•rsregnskapet er gjort opp, m√• styret beslutte hvordan √•rets resultat skal disponeres.</p>
                    <p><strong>Bokf√∏ring:</strong></p>
                    <ul>
                        <li>Debet 8800 (√Örsresultat): 800 000</li>
                        <li>Kredit 8920 (Avsatt utbytte): 300 000</li>
                        <li>Kredit 8960 (Overf√∏ring annen EK): 500 000</li>
                    </ul>
                `,
                type: "table",
                headers: ["Konto", "Beskrivelse", "Bel√∏p"],
                rows: [
                    { label: "8920", desc: "Avsatt utbytte", editable: true },
                    { label: "8960", desc: "Overf√∏ring annen egenkapital", editable: true },
                    { label: "SUM", desc: "Total disponering", editable: false, isSum: true }
                ],
                solution: [300000, 500000, 800000]
            },
            {
                id: 2,
                title: "Case 2: Resultatdisponering - Underskudd",
                category: "√Örsavslutning",
                difficulty: "easy",
                description: `
                    <h4>Beta Consulting AS - Underskudd for 20x5</h4>
                    <p><strong>Situasjon:</strong></p>
                    <p>Selskapet har dessverre g√•tt med underskudd dette √•ret.</p>
                    <ul>
                        <li>√Örsresultat (underskudd): kr -450 000</li>
                        <li>Underskuddet skal dekkes av annen egenkapital</li>
                    </ul>
                    <p><strong>Oppgave:</strong> Fyll inn disponeringen.</p>
                `,
                hint: `
                    <p><strong>Disponering av underskudd:</strong></p>
                    <ul>
                        <li>Underskudd dekkes vanligvis av annen egenkapital</li>
                        <li>Bel√∏pet skal v√¶re positivt i disponeringen</li>
                    </ul>
                    <p><code>Underskudd: -450 000, disponering: 450 000</code></p>
                `,
                explanation: `
                    <p><strong>Disponering av underskudd:</strong></p>
                    <p>N√•r selskapet g√•r med underskudd, m√• tapet dekkes ved √• redusere annen egenkapital.</p>
                    <p><strong>Bokf√∏ring:</strong></p>
                    <ul>
                        <li>Kredit 8800 (√Örsresultat): 450 000</li>
                        <li>Debet 8990 (Udekket tap): 450 000</li>
                    </ul>
                `,
                type: "table",
                headers: ["Konto", "Beskrivelse", "Bel√∏p"],
                rows: [
                    { label: "8990", desc: "Udekket tap / fra annen egenkapital", editable: true },
                    { label: "SUM", desc: "Total disponering", editable: false, isSum: true }
                ],
                solution: [450000, 450000]
            },
            {
                id: 3,
                title: "Case 3: Avskrivning av maskiner",
                category: "Anleggsmidler",
                difficulty: "easy",
                description: `
                    <h4>Gamma Production AS - Avskrivning av produksjonsutstyr</h4>
                    <p><strong>Situasjon:</strong></p>
                    <ul>
                        <li>Kj√∏pt maskin 01.01.20x5 for kr 500 000</li>
                        <li>Forventet levetid: 10 √•r</li>
                        <li>Avskrivningsmetode: Line√¶r</li>
                    </ul>
                    <p><strong>Oppgave:</strong> Beregn avskrivning for 20x5.</p>
                `,
                hint: `
                    <p><strong>Line√¶r avskrivning:</strong></p>
                    <p><code>√Örlig avskrivning = Anskaffelseskost / Levetid</code></p>
                    <p><code>√Örlig avskrivning = 500 000 / 10 = 50 000</code></p>
                `,
                explanation: `
                    <p><strong>Avskrivning av anleggsmidler:</strong></p>
                    <p>Anleggsmidler skal avskrives over √∏konomisk levetid.</p>
                    <ul>
                        <li>500 000 / 10 √•r = 50 000 kr/√•r</li>
                    </ul>
                `,
                type: "table",
                headers: ["Beskrivelse", "Bel√∏p"],
                rows: [
                    { label: "Anskaffelseskost", value: 500000, editable: false },
                    { label: "Levetid (√•r)", value: 10, editable: false },
                    { label: "Avskrivning 20x5", editable: true }
                ],
                solution: [50000]
            },
            {
                id: 4,
                title: "Case 4: Avskrivning - Del√•r",
                category: "Anleggsmidler",
                difficulty: "medium",
                description: `
                    <h4>Delta Tech AS - Avskrivning ved kj√∏p i l√∏pet av √•ret</h4>
                    <p><strong>Situasjon:</strong></p>
                    <ul>
                        <li>Kj√∏pt maskin 01.04.20x5 for kr 600 000</li>
                        <li>Forventet levetid: 5 √•r</li>
                        <li>Avskrivningsmetode: Line√¶r</li>
                    </ul>
                    <p><strong>Oppgave:</strong> Beregn avskrivning for 20x5 (kun 9 m√•neder).</p>
                `,
                hint: `
                    <p><strong>Avskrivning ved del√•r:</strong></p>
                    <p><code>√Örlig avskrivning = 600 000 / 5 = 120 000</code></p>
                    <p><code>Avskrivning 20x5 = 120 000 √ó (9/12) = 90 000</code></p>
                `,
                explanation: `
                    <p><strong>Avskrivning ved kj√∏p i l√∏pet av √•ret:</strong></p>
                    <ul>
                        <li>Hel√•rs avskrivning: 120 000</li>
                        <li>9 m√•neder: 120 000 √ó 9/12 = 90 000</li>
                    </ul>
                `,
                type: "table",
                headers: ["Beskrivelse", "Bel√∏p"],
                rows: [
                    { label: "Anskaffelseskost", value: 600000, editable: false },
                    { label: "Levetid (√•r)", value: 5, editable: false },
                    { label: "M√•neder i bruk 20x5", value: 9, editable: false },
                    { label: "Avskrivning 20x5", editable: true }
                ],
                solution: [90000]
            },
            {
                id: 5,
                title: "Case 5: Tap p√• kundefordringer",
                category: "Fordringer",
                difficulty: "medium",
                description: `
                    <h4>Epsilon Retail AS - Konstatering av tap p√• fordring</h4>
                    <p><strong>Situasjon:</strong></p>
                    <ul>
                        <li>Kundefordring: kr 75 000</li>
                        <li>Kunden har g√•tt konkurs</li>
                        <li>Tidligere avsetning: kr 15 000</li>
                    </ul>
                    <p><strong>Oppgave:</strong> Beregn tilleggstapet.</p>
                `,
                hint: `
                    <p><strong>Konstatering av tap:</strong></p>
                    <ul>
                        <li>Total fordring: 75 000</li>
                        <li>Allerede avsatt: 15 000</li>
                        <li>Tilleggstap = 75 000 - 15 000 = 60 000</li>
                    </ul>
                `,
                explanation: `
                    <p><strong>Tap p√• kundefordringer:</strong></p>
                    <p>N√•r en kundefordring blir konstatert som tap, m√• den fjernes fra balansen.</p>
                `,
                type: "table",
                headers: ["Beskrivelse", "Bel√∏p"],
                rows: [
                    { label: "Total kundefordring", value: 75000, editable: false },
                    { label: "Tidligere avsetning", value: 15000, editable: false },
                    { label: "Tilleggstap 20x5", editable: true }
                ],
                solution: [60000]
            },
            {
                id: 6,
                title: "Case 6: Periodisering - Forskuddsbetalt forsikring",
                category: "Periodisering",
                difficulty: "medium",
                description: `
                    <h4>Zeta Services AS - Periodisering av forsikring</h4>
                    <p><strong>Situasjon:</strong></p>
                    <ul>
                        <li>Betalt forsikring 01.10.20x5: kr 48 000</li>
                        <li>Forsikringen gjelder 12 m√•neder fremover</li>
                    </ul>
                    <p><strong>Oppgave:</strong> Hvor mye skal periodiseres som forskuddsbetalt?</p>
                `,
                hint: `
                    <p><strong>Periodisering:</strong></p>
                    <ul>
                        <li>I 20x5: 3 m√•neder (okt-des)</li>
                        <li>I 20x6: 9 m√•neder</li>
                        <li>Forskuddsbetalt: 48 000 √ó (9/12) = 36 000</li>
                    </ul>
                `,
                explanation: `
                    <p><strong>Periodisering etter sammenstillingsprinsippet.</strong></p>
                `,
                type: "table",
                headers: ["Beskrivelse", "Bel√∏p"],
                rows: [
                    { label: "Total betalt forsikring", value: 48000, editable: false },
                    { label: "M√•neder i 20x5", value: 3, editable: false },
                    { label: "M√•neder i 20x6", value: 9, editable: false },
                    { label: "Forskuddsbetalt 31.12.20x5", editable: true }
                ],
                solution: [36000]
            },
            {
                id: 7,
                title: "Case 7: P√•l√∏pte kostnader - L√∏nn",
                category: "Periodisering",
                difficulty: "medium",
                description: `
                    <h4>Eta Consulting AS - P√•l√∏pte l√∏nnskostnader</h4>
                    <p><strong>Situasjon ved √•rsskiftet:</strong></p>
                    <ul>
                        <li>Desember l√∏nn (utbetales 10.01): kr 350 000</li>
                        <li>P√•l√∏pte feriepenger: kr 95 000</li>
                    </ul>
                    <p><strong>Oppgave:</strong> Beregn totale p√•l√∏pte l√∏nnskostnader.</p>
                `,
                hint: `
                    <p><strong>P√•l√∏pte kostnader:</strong></p>
                    <ul>
                        <li>Desember l√∏nn: 350 000</li>
                        <li>P√•l√∏pte feriepenger: 95 000</li>
                        <li>Total: 350 000 + 95 000 = 445 000</li>
                    </ul>
                `,
                explanation: `
                    <p><strong>Periodisering av l√∏nnskostnader.</strong></p>
                `,
                type: "table",
                headers: ["Beskrivelse", "Bel√∏p"],
                rows: [
                    { label: "Desember l√∏nn (p√•l√∏pt)", value: 350000, editable: false },
                    { label: "P√•l√∏pte feriepenger", value: 95000, editable: false },
                    { label: "Sum p√•l√∏pte l√∏nnskostnader", editable: true }
                ],
                solution: [445000]
            },
            {
                id: 8,
                title: "Case 8: MVA-oppgj√∏r",
                category: "Merverdiavgift",
                difficulty: "medium",
                description: `
                    <h4>Theta Retail AS - MVA-oppgj√∏r</h4>
                    <p><strong>Termindata:</strong></p>
                    <ul>
                        <li>Utg√•ende MVA: kr 280 000</li>
                        <li>Inng√•ende MVA: kr 195 000</li>
                    </ul>
                    <p><strong>Oppgave:</strong> Beregn netto MVA til oppgj√∏r.</p>
                `,
                hint: `
                    <p><strong>MVA-oppgj√∏r:</strong></p>
                    <p><code>Netto MVA = Utg√•ende - Inng√•ende</code></p>
                    <p><code>= 280 000 - 195 000 = 85 000</code></p>
                `,
                explanation: `
                    <p><strong>Merverdiavgiftsoppgj√∏r.</strong></p>
                `,
                type: "table",
                headers: ["Beskrivelse", "Bel√∏p"],
                rows: [
                    { label: "Utg√•ende MVA", value: 280000, editable: false },
                    { label: "Inng√•ende MVA", value: 195000, editable: false },
                    { label: "Netto MVA til oppgj√∏r", editable: true }
                ],
                solution: [85000]
            },
            {
                id: 9,
                title: "Case 9: Arbeidsgiveravgift",
                category: "L√∏nn",
                difficulty: "medium",
                description: `
                    <h4>Iota AS - Arbeidsgiveravgift</h4>
                    <p><strong>L√∏nnsdata for desember:</strong></p>
                    <ul>
                        <li>Brutto l√∏nn: kr 500 000</li>
                        <li>Feriepenger p√•l√∏pt: kr 60 000</li>
                        <li>AGA-sats: 14,1%</li>
                    </ul>
                    <p><strong>Oppgave:</strong> Beregn total arbeidsgiveravgift.</p>
                `,
                hint: `
                    <p><strong>Arbeidsgiveravgift:</strong></p>
                    <ul>
                        <li>P√• l√∏nn: 500 000 √ó 14,1% = 70 500</li>
                        <li>P√• feriepenger: 60 000 √ó 14,1% = 8 460</li>
                        <li>Total: 78 960</li>
                    </ul>
                `,
                explanation: `
                    <p><strong>AGA beregnes av l√∏nn og feriepenger.</strong></p>
                `,
                type: "table",
                headers: ["Beskrivelse", "Bel√∏p"],
                rows: [
                    { label: "Brutto l√∏nn", value: 500000, editable: false },
                    { label: "Feriepenger", value: 60000, editable: false },
                    { label: "AGA-sats (%)", value: 14.1, editable: false },
                    { label: "Total arbeidsgiveravgift", editable: true }
                ],
                solution: [78960]
            },
            {
                id: 10,
                title: "Case 10: Betalbar skatt",
                category: "Skatt",
                difficulty: "hard",
                description: `
                    <h4>Kappa Invest AS - Beregning av betalbar skatt 20x5</h4>
                    <p><strong>Regnskapsdata:</strong></p>
                    <ul>
                        <li>Regnskapsmessig resultat f√∏r skatt: kr 1 200 000</li>
                        <li>Permanente forskjeller: kr 50 000</li>
                        <li>Skattemessige avskrivninger: kr 180 000</li>
                        <li>Regnskapsmessige avskrivninger: kr 150 000</li>
                        <li>Skattesats: 22%</li>
                    </ul>
                    <p><strong>Oppgave:</strong> Beregn betalbar skatt.</p>
                `,
                hint: `
                    <p><strong>Beregning:</strong></p>
                    <ol>
                        <li>Regnskapsmessig resultat: 1 200 000</li>
                        <li>+ Permanente forskjeller: +50 000</li>
                        <li>- Ekstra skattemessige avskrivninger: -30 000</li>
                        <li>= Alminnelig inntekt: 1 220 000</li>
                        <li>√ó 22% = 268 400</li>
                    </ol>
                `,
                explanation: `
                    <p><strong>Forskjellen mellom regnskapsmessig og skattemessig resultat.</strong></p>
                `,
                type: "table",
                headers: ["Beskrivelse", "Bel√∏p"],
                rows: [
                    { label: "Regnskapsmessig resultat", value: 1200000, editable: false },
                    { label: "Permanente forskjeller", value: 50000, editable: false },
                    { label: "Midlertidige forskjeller", value: -30000, editable: false },
                    { label: "Alminnelig inntekt", value: 1220000, editable: false },
                    { label: "Betalbar skatt (22%)", editable: true }
                ],
                solution: [268400]
            },
            {
                id: 11,
                title: "Case 11: Varelagerendring",
                category: "Varekostnad",
                difficulty: "hard",
                description: `
                    <h4>Lambda Trading AS - Beregning av varekostnad</h4>
                    <p><strong>Varelagertall for 20x5:</strong></p>
                    <ul>
                        <li>Varelager 01.01.20x5: kr 450 000</li>
                        <li>Innkj√∏p av varer: kr 2 800 000</li>
                        <li>Varelager 31.12.20x5: kr 520 000</li>
                    </ul>
                    <p><strong>Oppgave:</strong> Beregn varekostnad for 20x5.</p>
                `,
                hint: `
                    <p><strong>Varekostnad:</strong></p>
                    <p><code>Varekostnad = IB + Innkj√∏p - UB</code></p>
                    <p><code>= 450 000 + 2 800 000 - 520 000 = 2 730 000</code></p>
                `,
                explanation: `
                    <p><strong>Varekostnad (solgte varers kostnad).</strong></p>
                `,
                type: "table",
                headers: ["Beskrivelse", "Bel√∏p"],
                rows: [
                    { label: "Varelager 01.01 (IB)", value: 450000, editable: false },
                    { label: "Innkj√∏p av varer 20x5", value: 2800000, editable: false },
                    { label: "Varelager 31.12 (UB)", value: 520000, editable: false },
                    { label: "Varekostnad 20x5", editable: true }
                ],
                solution: [2730000]
            },
            {
                id: 12,
                title: "Case 12: Salg av anleggsmiddel",
                category: "Anleggsmidler",
                difficulty: "hard",
                description: `
                    <h4>Mu Production AS - Salg av brukt maskin</h4>
                    <p><strong>Situasjon:</strong></p>
                    <ul>
                        <li>Opprinnelig anskaffelseskost: kr 800 000</li>
                        <li>Akkumulerte avskrivninger: kr 550 000</li>
                        <li>Bokf√∏rt verdi: kr 250 000</li>
                        <li>Salgspris (ekskl. mva): kr 320 000</li>
                    </ul>
                    <p><strong>Oppgave:</strong> Beregn gevinst ved salg.</p>
                `,
                hint: `
                    <p><strong>Gevinst/tap:</strong></p>
                    <p><code>Gevinst = Salgspris - Bokf√∏rt verdi</code></p>
                    <p><code>= 320 000 - 250 000 = 70 000</code></p>
                `,
                explanation: `
                    <p><strong>Salg av anleggsmidler.</strong></p>
                `,
                type: "table",
                headers: ["Beskrivelse", "Bel√∏p"],
                rows: [
                    { label: "Anskaffelseskost", value: 800000, editable: false },
                    { label: "Akkumulerte avskrivninger", value: 550000, editable: false },
                    { label: "Bokf√∏rt verdi", value: 250000, editable: false },
                    { label: "Salgspris (ekskl. mva)", value: 320000, editable: false },
                    { label: "Gevinst ved salg", editable: true }
                ],
                solution: [70000]
            },
            {
                id: 13,
                title: "Case 13: Utsatt skatt",
                category: "Skatt",
                difficulty: "hard",
                description: `
                    <h4>Nu Tech AS - Beregning av utsatt skatt</h4>
                    <p><strong>Situasjon ved utgangen av 20x5:</strong></p>
                    <ul>
                        <li>Bokf√∏rt verdi maskiner: kr 400 000</li>
                        <li>Skattemessig verdi maskiner: kr 320 000</li>
                        <li>Midlertidig forskjell: kr 80 000</li>
                        <li>Skattesats: 22%</li>
                    </ul>
                    <p><strong>Oppgave:</strong> Beregn utsatt skatt.</p>
                `,
                hint: `
                    <p><strong>Utsatt skatt:</strong></p>
                    <p><code>Utsatt skatt = Forskjell √ó Skattesats</code></p>
                    <p><code>= 80 000 √ó 22% = 17 600</code></p>
                `,
                explanation: `
                    <p><strong>Utsatt skatt (deferred tax).</strong></p>
                `,
                type: "table",
                headers: ["Beskrivelse", "Bel√∏p"],
                rows: [
                    { label: "Bokf√∏rt verdi maskiner", value: 400000, editable: false },
                    { label: "Skattemessig verdi maskiner", value: 320000, editable: false },
                    { label: "Midlertidig forskjell", value: 80000, editable: false },
                    { label: "Skattesats (%)", value: 22, editable: false },
                    { label: "Utsatt skatt", editable: true }
                ],
                solution: [17600]
            },
            {
                id: 14,
                title: "Case 14: Kompleks resultatdisponering",
                category: "√Örsavslutning",
                difficulty: "hard",
                description: `
                    <h4>Omega Industries AS - Komplett resultatdisponering</h4>
                    <p><strong>Situasjon for 20x5:</strong></p>
                    <ul>
                        <li>√Örsresultat f√∏r disponering: kr 1 250 000</li>
                        <li>Styret foresl√•r nytt utbytte: kr 500 000</li>
                        <li>Rest til annen egenkapital</li>
                    </ul>
                    <p><strong>Oppgave:</strong> Beregn overf√∏ring til annen egenkapital.</p>
                `,
                hint: `
                    <p><strong>Viktig:</strong> Vi disponerer kun √•rets resultat.</p>
                    <ul>
                        <li>Nytt utbytte: 500 000</li>
                        <li>Rest: 1 250 000 - 500 000 = 750 000</li>
                    </ul>
                `,
                explanation: `
                    <p><strong>Kompleks resultatdisponering.</strong></p>
                `,
                type: "table",
                headers: ["Beskrivelse", "Bel√∏p"],
                rows: [
                    { label: "√Örsresultat 20x5", value: 1250000, editable: false },
                    { label: "Avsatt utbytte 20x5", value: 500000, editable: false },
                    { label: "Overf√∏ring annen egenkapital", editable: true }
                ],
                solution: [750000]
            },
            {
                id: 15,
                title: "Case 15: Master Challenge - Komplett √•rsavslutning",
                category: "√Örsavslutning",
                difficulty: "hard",
                description: `
                    <h4>Pi Enterprises AS - Komplett √•rsavslutning</h4>
                    <p><strong>Det mangler f√∏lgende poster ved √•rsskiftet:</strong></p>
                    <ol>
                        <li>Avskrivning maskiner (kj√∏pt 01.07 for 480 000, levetid 8 √•r)</li>
                        <li>P√•l√∏pt desember l√∏nn: kr 280 000</li>
                        <li>P√•l√∏pte feriepenger: kr 75 000</li>
                        <li>Arbeidsgiveravgift (14,1%)</li>
                    </ol>
                    <p><strong>Oppgave:</strong> Beregn totale tilleggskostnader.</p>
                `,
                hint: `
                    <p><strong>Beregning:</strong></p>
                    <ol>
                        <li>Avskrivning: 480 000 / 8 √ó 6/12 = 30 000</li>
                        <li>L√∏nn: 280 000</li>
                        <li>Feriepenger: 75 000</li>
                        <li>AGA p√• l√∏nn: 280 000 √ó 14,1% = 39 480</li>
                        <li>AGA p√• feriepenger: 75 000 √ó 14,1% = 10 575</li>
                        <li>Total: 435 055</li>
                    </ol>
                `,
                explanation: `
                    <p><strong>Komplett √•rsavslutning - alle elementer.</strong></p>
                `,
                type: "table",
                headers: ["Beskrivelse", "Bel√∏p"],
                rows: [
                    { label: "1. Avskrivning maskiner", editable: true },
                    { label: "2. P√•l√∏pt l√∏nn", editable: true },
                    { label: "3. P√•l√∏pte feriepenger", editable: true },
                    { label: "4. AGA p√• l√∏nn", editable: true },
                    { label: "5. AGA p√• feriepenger", editable: true },
                    { label: "TOTALE TILLEGGSKOSTNADER", editable: true }
                ],
                solution: [30000, 280000, 75000, 39480, 10575, 435055]
            }
        ];

        // Game state
        let gameState = {
            currentTask: 0,
            completedTasks: [],
            score: 0
        };

        // Initialize
        function init() {
            loadTaskList();
            loadTask(0);
            loadProgress();
        }

        function loadTaskList() {
            const taskList = document.getElementById('task-list');
            taskList.innerHTML = '';

            tasks.forEach((task, index) => {
                const isCompleted = gameState.completedTasks.includes(task.id);
                const isActive = index === gameState.currentTask;

                const item = document.createElement('div');
                item.className = 'task-item' + (isActive ? ' active' : '') + (isCompleted ? ' completed' : '');
                item.onclick = () => loadTask(index);

                const statusClass = isCompleted ? 'completed' : 'not-started';
                const statusText = isCompleted ? '‚úì Fullf√∏rt' : 'Ikke startet';

                item.innerHTML = `
                    <div class="task-item-title">${task.title}</div>
                    <div class="task-item-category">${task.category}</div>
                    <span class="task-item-difficulty difficulty-${task.difficulty}">
                        ${task.difficulty === 'easy' ? '‚≠ê Lett' : task.difficulty === 'medium' ? '‚≠ê‚≠ê Middels' : '‚≠ê‚≠ê‚≠ê Vanskelig'}
                    </span>
                    <span class="status-badge ${statusClass}">${statusText}</span>
                `;

                taskList.appendChild(item);
            });
        }

        function loadTask(index) {
            if (index < 0 || index >= tasks.length) return;

            gameState.currentTask = index;
            const task = tasks[index];

            // Update header
            document.getElementById('current-task').textContent = index + 1;
            document.getElementById('total-tasks').textContent = tasks.length;

            // Update progress
            updateProgress();

            // Load task content
            const content = document.getElementById('task-content');
            content.innerHTML = `
                <div class="task-header">
                    <div class="task-title">${task.title}</div>
                    <div class="task-description">${task.description}</div>
                </div>
            `;

            // Render table
            renderTaskTable(task);

            // Reset feedback
            document.getElementById('feedback').className = 'feedback';
            document.getElementById('hint-box').classList.remove('show');
            document.getElementById('explanation-box').classList.remove('show');
            document.getElementById('next-btn').style.display = 'none';

            // Update task list
            loadTaskList();
        }

        function renderTaskTable(task) {
            const content = document.getElementById('task-content');
            
            let tableHTML = `
                <div class="excel-grid">
                    <div class="grid-controls">
                        <button class="grid-btn" onclick="resetTask()">üóëÔ∏è Nullstill svar</button>
                    </div>
                    <table class="spreadsheet">
                        <thead>
                            <tr>
                                ${task.headers.map(h => `<th>${h}</th>`).join('')}
                            </tr>
                        </thead>
                        <tbody id="table-body">
            `;

            task.rows.forEach((row, rowIndex) => {
                tableHTML += '<tr>';
                
                if (row.label) {
                    tableHTML += `<td class="cell-label">${row.label}</td>`;
                }
                
                if (row.desc) {
                    tableHTML += `<td><input type="text" class="cell text-cell readonly" value="${row.desc}" readonly></td>`;
                }
                
                if (row.value !== undefined) {
                    tableHTML += `<td><input type="text" class="cell readonly" value="${row.value}" readonly></td>`;
                }
                
                if (row.editable || row.isSum) {
                    const placeholder = row.isSum ? 'Beregnes automatisk' : 'Skriv svar eller formel (=A1+A2)';
                    const readonly = row.isSum ? 'readonly' : '';
                    const extraClass = row.isSum ? 'readonly' : '';
                    tableHTML += `<td><input type="text" class="cell ${extraClass}" 
                                             data-row="${rowIndex}" 
                                             placeholder="${placeholder}"
                                             oninput="handleFormula(this)"
                                             ${readonly}></td>`;
                }
                
                tableHTML += '</tr>';
            });

            tableHTML += `
                        </tbody>
                    </table>
                </div>
            `;

            content.insertAdjacentHTML('beforeend', tableHTML);

            // Add event listeners for auto-sum if needed
            if (task.rows.some(r => r.isSum)) {
                document.querySelectorAll('.cell[type="number"]:not(.readonly)').forEach(input => {
                    input.addEventListener('input', updateSum);
                });
            }
        }

        function updateSum() {
            const inputs = document.querySelectorAll('.cell[type="number"]:not(.readonly)');
            const sumCell = document.querySelector('.cell.readonly[type="number"]');
            
            if (!sumCell) return;

            let sum = 0;
            inputs.forEach(input => {
                sum += parseFloat(input.value) || 0;
            });
            
            sumCell.value = sum;
        }

        function handleFormula(cell) {
            // Handle Excel-like formulas in input fields
            const val = cell.value.trim();
            if (!val.startsWith('=')) return;
            
            try {
                // Replace cell references like A1, B2 with their values
                let formula = val.substring(1);
                
                // Simple formula evaluation (can be enhanced)
                const result = eval(formula.replace(/[A-Z]\d+/gi, '0'));
                
                if (!isNaN(result)) {
                    cell.dataset.formula = val;
                    cell.dataset.result = result;
                    cell.value = result.toFixed(2);
                }
            } catch(e) {
                console.log('Formula error:', e);
            }
        }

        function checkAnswer() {
            const task = tasks[gameState.currentTask];
            const inputs = document.querySelectorAll('.cell[type="number"]:not(.readonly)');
            
            let correctCount = 0;
            let totalCount = task.solution.length;

            inputs.forEach((input, index) => {
                if (index >= task.solution.length) return;
                
                const userValue = parseFloat(input.value) || 0;
                const expectedValue = task.solution[index];
                
                // Allow 1% tolerance for rounding
                const tolerance = Math.abs(expectedValue) * 0.01;
                if (Math.abs(userValue - expectedValue) <= tolerance || Math.abs(userValue - expectedValue) <= 1) {
                    correctCount++;
                    input.classList.add('correct');
                    input.classList.remove('incorrect');
                } else {
                    input.classList.add('incorrect');
                    input.classList.remove('correct');
                }
            });

            const feedback = document.getElementById('feedback');
            
            if (correctCount === totalCount) {
                gameState.score += task.difficulty === 'hard' ? 15 : task.difficulty === 'medium' ? 10 : 5;
                if (!gameState.completedTasks.includes(task.id)) {
                    gameState.completedTasks.push(task.id);
                }
                
                feedback.className = 'feedback correct show';
                feedback.innerHTML = 'üéâ Riktig! Flott jobbet!<br><small>Klikk "Forklaring" for √• l√¶re mer</small>';
                
                document.getElementById('next-btn').style.display = 'inline-block';
                
                // Show explanation
                const explBox = document.getElementById('explanation-box');
                explBox.classList.add('show');
                document.getElementById('explanation-content').innerHTML = task.explanation;
            } else {
                feedback.className = 'feedback incorrect show';
                feedback.innerHTML = `‚úó ${correctCount} av ${totalCount} riktige svar. Pr√∏v igjen!<br>
                                      <small>Riktige svar er markert i gr√∏nt, feil i r√∏dt.</small>`;
            }

            updateStats();
            loadTaskList();
            saveProgress();
        }

        function showHint() {
            const task = tasks[gameState.currentTask];
            document.getElementById('hint-content').innerHTML = task.hint;
            document.getElementById('hint-box').classList.add('show');
        }

        function resetTask() {
            const inputs = document.querySelectorAll('.cell[type="number"]:not(.readonly)');
            inputs.forEach(input => {
                input.value = '';
                input.classList.remove('correct', 'incorrect');
            });
            
            document.getElementById('feedback').className = 'feedback';
            document.getElementById('hint-box').classList.remove('show');
            document.getElementById('explanation-box').classList.remove('show');
        }

        function nextTask() {
            const nextIndex = gameState.currentTask + 1;
            if (nextIndex < tasks.length) {
                loadTask(nextIndex);
            } else {
                showCompletion();
            }
        }

        function updateStats() {
            document.getElementById('completed-count').textContent = gameState.completedTasks.length;
            document.getElementById('score').textContent = gameState.score;
        }

        function updateProgress() {
            const progress = (gameState.completedTasks.length / tasks.length) * 100;
            const progressFill = document.getElementById('progress-fill');
            progressFill.style.width = progress + '%';
            progressFill.textContent = Math.round(progress) + '%';
        }

        function saveProgress() {
            localStorage.setItem('case_studies_progress', JSON.stringify(gameState));
        }

        function loadProgress() {
            const saved = localStorage.getItem('case_studies_progress');
            if (saved) {
                const progress = JSON.parse(saved);
                gameState.completedTasks = progress.completedTasks || [];
                gameState.score = progress.score || 0;
                updateStats();
                updateProgress();
            }
        }

        function backToMenu() {
            saveProgress();
            window.location.href = 'index.html';
        }

        function showCompletion() {
            const workspace = document.querySelector('.workspace');
            workspace.innerHTML = `
                <div style="text-align: center; padding: 60px 20px;">
                    <h1 style="font-size: 3em; color: var(--accent); margin-bottom: 20px;">üéâ Gratulerer!</h1>
                    <p style="font-size: 1.5em; margin-bottom: 40px;">Du har fullf√∏rt alle case-oppgavene!</p>
                    
                    <div style="background: var(--bg-secondary); border: 2px solid var(--accent); border-radius: 15px; 
                                padding: 40px; max-width: 500px; margin: 0 auto 40px;">
                        <h3 style="color: var(--accent); margin-bottom: 20px; font-size: 1.5em;">Din statistikk</h3>
                        <div style="font-size: 1.3em; line-height: 2;">
                            <p>‚úÖ Oppgaver fullf√∏rt: ${gameState.completedTasks.length}/${tasks.length}</p>
                            <p>‚≠ê Totalt poeng: ${gameState.score}</p>
                        </div>
                    </div>
                    
                    <button class="action-btn check" onclick="backToMenu()" style="font-size: 1.2em; padding: 20px 50px;">
                        Tilbake til meny
                    </button>
                </div>
            `;
            
            saveProgress();
        }

        // Initialize
        window.onload = init;
    </script>
    
    <!-- Theme Manager -->
    <script src="js/theme-manager.js"></script>
    <script>
        // Initialize theme after DOM loads
        if (typeof ThemeManager !== 'undefined' && ThemeManager.init) {
            ThemeManager.init();
        }
    </script>
</body>
</html>
